<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>商家基本資料</title>

    <!-- Google Font: Source Sans Pro -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback"
    />
    <!-- Font Awesome -->

    <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css" />
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/adminlte.min.css" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
  </head>
  <body class="hold-transition sidebar-mini">
    <div class="wrapper">
      <!-- Navbar -->
      <div class="storeheader"></div>
      <!-- /.navbar -->
      <div class="storeaside"></div>
      <!-- Main Sidebar Container -->

      <div style="margin: auto; max-width: 60%">
        <h1 class="text-center">商家基本資料</h1>
        <div class="container m-5 shadow-lg p-3 mb-5 bg-body rounded">
          <form>
            <div class="m-3">
              <label for="帳號(統編)" class="form-label">帳號</label>
              <input
                readonly
                type="text"
                class="form-control"
                id="vat"

              />
            </div>

            <div class="m-3">
              <label class="form-label">商店名稱</label>
              <input
                readonly
                type="text"
                class="form-control"

                id="sotreName"
              />
            </div>
            <div class="m-3">
              <label class="form-label">註冊日</label>
              <input
                readonly
                type="date"
                class="form-control"

                id="register"
              />
            </div>
            <div class="m-3">
              <label class="form-label">商店地址</label>
              <input
                readonly
                type="text"
                class="form-control"

                id="storeAddress"
              />
            </div>
            <div class="m-3">
              <label class="form-label">商店電話</label>
              <input
                readonly
                type="text"
                class="form-control"

                id="storePhone"
              />
            </div>
            <div class="m-3">
              <label class="form-label">開始營業時間</label>
              <input
                readonly
                type="time"
                class="form-control"

                id="openingHours"
              />
            </div>
            <div class="m-3">
              <label class="form-label">結束營業時間</label>
              <input
                readonly
                type="time"
                class="form-control"

                id="closingHours"
              />
            </div>
            <div class="m-3">
              <label class="form-label">公休日</label>
              <input
                readonly
                type="text"
                class="form-control"

                id="rest"
              />
            </div>
            <div class="m-3 form-check">
              <input
                disabled
                type="checkbox"
                class="form-check-input"
                id="isTakeOrder"
              />
              <label class="form-check-label">是否接受訂單</label>
            </div>
            <div class="m-3 form-check">
              <input
                disabled
                type="checkbox"
                class="form-check-input"
                id="isDelivery"
              />
              <label class="form-check-label">是否外送</label>
            </div>
            <div class="m-3 input-group">
              <label class="form-label input-group">外送門檻金額</label>
              <input
                readonly
                type="text"
                class="input-group form-control"
                value="500"
                id="deliveryMoney"
              />
              <span class="input-group-text" style="margin-right: 30px"
                >NTD(新台幣)</span
              >
            </div>
            <div class="m-3 input-group">
              <label class="form-label input-group">外送距離限制</label>
              <input
                readonly
                type="text"
                class="input-group form-control"
                id="deliveryDistance"
              />
              <span class="input-group-text" style="margin-right: 30px"
                >KM(公里)</span
              >
            </div>



            <div class="m-3">
              <label class="form-label">信箱</label>
              <input
                disabled
                type="email"
                class="form-control"
                id="storeEmail"

              />
            </div>
            <div class="m-3">
              <label class="form-label">聯絡人</label>
              <input
                disabled
                type="text"
                class="form-control"

                id="contactPerson"
              />
            </div>
            <div class="m-3">
              <label class="form-label">聯絡人電話</label>
              <input
                disabled
                type="text"
                class="form-control"

                id="contactPhone"
              />
            </div>

            <div class="m-3">
              <label class="form-label">店家所有人</label>
              <input
                readonly
                type="text"
                class="form-control"

                id="owner"
              />
            </div>
            <div class="m-3">
              <label class="form-label">集點卡名稱</label>
              <input
                disabled
                type="text"
                class="form-control"

                id="loyaltyCardName"
              />
            </div>
            <div class="m-3">
              <label class="form-label">點數兌換比例</label>
              <input
                disabled
                type="text"
                class="form-control"

                id="exchangeRate"
              />
              <div class="form-text">輸入多少新台幣兌換一點</div>
            </div>
            <div class="m-3">
              <label class="form-label">集點卡有效期限</label>
              <input
                readonly
                type="text"
                class="form-control"
                value="Null"
                id="expiredDate"
              />
              <div class="form-text">集點卡關閉後半年後失效</div>
            </div>

            <div class="m-3">
              <label class="form-check-label" for="flexRadioCheckedDisabled">
                店家帳號狀態
              </label>
              <select
                class="form-select"
                disabled
                aria-label=".form-select-sm example"
                id="storeStatus"
              >
                <option value="0">審核中</option>
                <option value="1">使用中</option>
                <option value="2">停權中</option>

                <option value="4">申請失敗</option>
              </select>

            </div>
            <div class="m-3 d-flex align-content-center" >
              <img src="" id="storeImg" height="200px" width="200px" />
            </div>

            <!-- <button type="submit" class="btn btn-primary m-3">儲存</button> -->
            <div class="row">
              <div class="col-3"></div>
              <div class="col-6">
                <a id="storeEdit" href="#" class="btn btn-primary m-3">編輯</a>
                <a
                  id="storeLoyaltyCard"
                  href="storeInfoEditLoyaltyCard.html"
                  class="btn btn-primary m-3"
                  >設定集點卡</a
                >
                <a href="storeList.html" class="btn btn-primary m-3">返回</a>
              </div>
              <div class="col-3"></div>
            </div>
          </form>
          <input type="hidden" id="userTypeId">
        </div>
      </div>
      <!-- Content Wrapper. Contains page content -->

      <!-- /.content-wrapper -->

      <!-- /.control-sidebar -->
      <div class="storefooter"></div>
    </div>
    <!-- ./wrapper -->

    <!-- jQuery -->
    <script src="plugins/jquery/jquery.min.js"></script>
    <script src="js/storegeneral.js"></script>

    <!-- Bootstrap 4 -->
    <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- AdminLTE App -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script src="dist/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="dist/js/demo.js"></script>
    <!--sweetalert2-->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        //取得storeid
        let sotreid = location.search.split("?")[1];


        $.ajax({
          url: `/store/storeinfo/${sotreid.split("=")[1]}`,
          method: "GET",
          dataType: "JSON",
          async: false,
          success: function (data) {

            console.log(data.successful);
            if(!data.successful){
              //登入失敗
              location.href = "./backstageLogin.html";
            }


            fetch("/store/GetLoginType").then(resp => resp.json()).then(
                    res => {

                      console.log(res);
                      document.querySelector('#userTypeId').value= res.userTypeId;

                      if(res.userTypeId !== 3){

                        document.querySelector('#storeListAsideLink').classList.add("d-none");
                      }



                      document.querySelector("#storeInfoAsideLink").href= location.href;
                      document.querySelector("#storeLoyaltyCardAsideLink").href=`storeInfoEditLoyaltyCard.html?storeid=${sotreid.split("=")[1]}`;
                      document.querySelector("#storePasswordAsideLink").href=`storeInfoEditPassword.html?storeid=${sotreid.split("=")[1]}`;

                    }
            );
            fetch(`/store/holidays/${sotreid.split("=")[1]}`).then(data => data.json()).then(
                    res =>{
                      res.forEach(function (day){
                        document.querySelector("#rest").value += day+", "
                      });
                    }
            )
            setTimeout(() => {

              //確認是否帳號違停權
              if(data.storeStatus === 2){

                if(document.querySelector('#userTypeId').value === 3){
                  Swal.fire({text:"此商家已被停權"});
                }
                else{
                  Swal.fire({
                    text:"帳號停權，請聯絡管理員",
                    icon:"warning",
                    confirmButtonColor: "#3085d6",
                    confirmButtonText: "確認"
                  }).then(res=>{
                    if(res.isConfirmed){
                      // location.href = "./backstageLogin.html";
                    }
                  });
                }

              }
            }, 1000);







            document.querySelector(
              "#storeLoyaltyCard"
            ).href = `storeInfoEditLoyaltyCard.html?sotreid=${
              sotreid.split("=")[1]
            }`;

            document.querySelector(
              "#storeEdit"
            ).href = `storeInfoEdit.html?storeid=${sotreid.split("=")[1]}`;

            document.querySelector("#vat").value = data.vat;
            document.querySelector("#sotreName").value = data.storeName;
            document.querySelector("#register").value =
              data.registerDay.split("T")[0];
            document.querySelector("#storeAddress").value = data.storeAddress;
            document.querySelector("#storePhone").value = data.storePhone;
            console.log(data.openingHours);
            console.log(data.closingHours);
            document.querySelector("#openingHours").value = data.openingHours;
            document.querySelector("#closingHours").value = data.closingHours;


            if(data.isDelivery){
              document.querySelector("#isDelivery").checked = true;
            }
            if(data.deliveryDistance === 0.0){
              document.querySelector("#deliveryDistance").value = "暫不提供外送服務";
            }else{
              document.querySelector("#deliveryDistance").value =
                      data.deliveryDistance;

            }




            if(data.isTakeOrders){
              document.querySelector("#isTakeOrder").checked = data.isTakeOrders;
            }
            document.querySelector("#deliveryMoney").value = data.deliveryMoney;

            document.querySelector("#storeEmail").value = data.email;
            document.querySelector("#contactPerson").value = data.contactPerson;
            document.querySelector("#contactPhone").value = data.contactPhone;

            document.querySelector("#storeStatus").value = data.storeStatus;
            document.querySelector("#owner").value = data.owner;
            document.querySelector("#loyaltyCardName").value =
              data.loyaltyCardName;
            document.querySelector("#exchangeRate").value = data.exchangeRate;
            console.log(data.expiredDate);

            document.querySelector("#expiredDate").value = data.expiredDate!=null?
              data.expiredDate.split("T")[0]:  "激活中";

            const base64image = data.logo;

             document.querySelector('#storeImg').src = `data:image/png;base64,${base64image}`;

            //success結束
          },
          err: function (data) {
            console.log("失敗");
            console.log(data);

          },
        });






      }); //DOM END
    </script>
  </body>
</html>
