<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>後台 | 商品資料</title>



    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="dist/css/adminlte.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
    <style>
        img.preview {
            width: 300px;
            height: 350px;
        }

        ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        ul>li {
            display: inline-block;
            vertical-align: top;
        }



        .btn-info{
            background-color: #73B4BA;
            border-color: #73B4BA;
        }





    </style>


</head>

<body class="hold-transition sidebar-mini">

  <div class="wrapper">
    <div class="storeheader"></div>
    <div class="storeaside"></div>


      <div class="content-wrapper">
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1>商品資料</h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#">Home</a></li>
                            <li class="breadcrumb-item active">Projects</li>
                        </ol>
                    </div>
                </div>
            </div><!-- /.container-fluid -->
        </section>
        <section class="content">
            <div class="container-fluid">
                <div class="row justify-content-center">
                    <!-- left column -->
                    <div class="col-md-9">

                        <div class="card card-primary  mx-auto">

                            <!-- form start -->
                            <form id="productForm" action="file/upload" method="post" enctype="multipart/form-data">
                                <div class="card-body">

                                    <div class="form-group">
                                        <label for="productname">商品名稱</label> <span style="color: red">*</span>
                                        <input type="text" class="form-control" id="productname" placeholder="請輸入商品名稱" name="productName">
                                    </div>
                                    <p class="message" style="color: red"></p>
                                    <div class="form-group">
                                        <label for="productprice">商品價格(請填台幣)</label><span style="color: red">*</span>
                                        <input type="number" class="form-control" id="productprice" placeholder="65" name="productPrice" min="1" max="999">
                                        <span class="productprice-message" style="color: red"></span>
                                    </div>

                                        <div class="form-group">
                                            <label for="size">商品尺寸</label><span style="color: red">*</span>
                                            <select class="custom-select rounded-0" id="size" name="productsize">
                                            <option value="S">S</option>
                                            <option value="M">M</option>
                                            <option value="L">L</option>
                                        </select>

                                    </div>

                                    <div class="form-group">
                                        <label for="status">商品狀態</label><span style="color: red">*</span>
                                        <span class="status-message" style="color: red"></span>
                                        <select class="custom-select rounded-0" id="status" name="productStatus">
                                            <option value="0">上架</option>
                                            <option value="1">下架</option>
                                        </select>
                                    </div>

                                    <div class="form-group">

                                        <label for="productpic">商品圖片</label>
                                        <span class="productpic-message" style="color:red;"></span>
                                        <div class="custom-file">
                                            <ul class="picture_list">

                                            </ul>
                                            <input type="file" class="custom-file-input" id="productpic">
                                            <label class="custom-file-label" for="productpic">選圖</label>
                                        </div>

                                    </div>


                                    <div class="form-group">
                                        <label>商品分類</label><span style="color: red">*</span>
                                        <span class="category-message" style="color: red"></span>
                                        <select class="category" name="productCategoryId">
                                            <option>option 1</option>
                                            <option>option 2</option>
                                            <option>option 3</option>
                                            <option>option 4</option>
                                            <option>option 5</option>
                                        </select>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-4">

                                            <label class="form-check-label">冰塊調整</label><span style="color: red">*</span>
                                            <span for="name" class="category-message" style="color: red"></span>

                                            <div class="form-check">
                                                <input type="checkbox" id="allice" onclick="selectAllIce()">
                                                <label class="form-check-label">全選</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="item" type="checkbox" name="normalIce"
                                                    value="1" checked>
                                                <label class="form-check-label">正常冰</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="item" type="checkbox" name="lessIce"
                                                    value="1">
                                                <label class="form-check-label">少冰</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="item" type="checkbox" name="lightIce"
                                                    value="1">
                                                <label class="form-check-label">微冰</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="item" type="checkbox" name="iceFree"
                                                    value="1">
                                                <label class="form-check-label">去冰</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="item" type="checkbox" name="roomTeperature"
                                                    value="1">
                                                <label class="form-check-label">常溫</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="item" type="checkbox" name="hot" value="1">
                                                <label class="form-check-label">熱</label>
                                            </div>

                                        </div>


                                        <div class="form-group col-4">
                                            <label fclass="form-check-label">甜度調整</label><span style="color: red">*</span>
                                            <span class="category-message" style="color: red"></span>

                                            <div class="form-check">
                                                <input type="checkbox" id="allsugar" name="category">
                                                <label class="form-check-label">全選</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemtwo" type="checkbox" name="fullSugar" value="1" checked>
                                                <label class="form-check-label">全糖</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemtwo" type="checkbox" name="lessSugar"
                                                    value="1">
                                                <label class="form-check-label">少糖</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemtwo" type="checkbox" name="halfSugar"
                                                    value="1">
                                                <label class="form-check-label">半糖</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemtwo" type="checkbox" name="quarterSugar"
                                                    value="1">
                                                <label class="form-check-label">微糖</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemtwo" type="checkbox" name="noSugar" value="1">
                                                <label class="form-check-label">無糖</label>
                                            </div>
                                        </div>
                                        <div class="form-group col-4">
                                            <label class="form-check-label">加料</label>
                                            <div class="form-check">
                                                <input type="checkbox" id="allmaterials">
                                                <label class="form-check-label">全選</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemthree" type="checkbox" name="pearl" value="1">
                                                <label class="form-check-label">珍珠</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemthree" type="checkbox" name="pudding" value="1">
                                                <label class="form-check-label">布丁</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemthree" type="checkbox" name="coconut_jelly" value="1">
                                                <label class="form-check-label">椰果</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemthree" type="checkbox" name="taro" value="1">
                                                <label class="form-check-label">芋圓</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemthree" type="checkbox" name="herbal_jelly" value="1">
                                                <label class="form-check-label">仙草凍</label>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <button type="submit" class="btn btn-primary m-3 btn-info">新增商品</button>

                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                </div>
        </section>
      </div>
           <div class="storefooter"></div>

  </div>




    <script src="plugins/jquery/jquery.min.js"></script>
  <script src="js/storegeneral.js"></script>

    <script src="plugins/jquery-ui/jquery-ui.min.js"></script>
    <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
    <script src="plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="plugins/jquery-validation/jquery.validate.min.js"></script>
  <script src="plugins/jquery-validation/additional-methods.min.js"></script>
  <script src="dist/js/adminlte.js"></script>
  <script src="dist/js/demo.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/validate.js/0.13.1/validate.min.js"></script>



  <script>
        <!--顯示商品圖-->
        var the_file = document.getElementById("productpic");
        the_file.addEventListener("change", function () {
            let ul_el = document.getElementsByClassName("picture_list")[0];
            ul_el.innerHTML = ""

            let that = this;
            for (let i = 0; i < this.files.length; i++) {
                let reader = new FileReader(); reader.readAsDataURL(this.files[i]);
                reader.addEventListener("load", function () { // console.log(reader.result); // this 是input標籤 let li_str="" ;
                    let li_str = '';
                    li_str += '<li>';
                    li_str += '<img src="' + reader.result + '" class="preview">';
                    li_str += '</li>';
                    ul_el.insertAdjacentHTML("beforeend", li_str);
                })
            }
        })
       // 冰的全選
       var allice=document.getElementById("allice")
        allice.addEventListener("click",function (){
            var that=this
            var itemone=document.querySelectorAll("input.item")
            itemone.forEach(function (item,i){
                item.checked=that.checked
            })
        })

        var itemone=document.querySelectorAll("input.item");
        itemone.forEach(function (item,i){
            item.addEventListener("click",function (){
                var checked_length=document.querySelectorAll("input.item:checked").length;
                var all_length=document.querySelectorAll("input.item").length;

            allice.checked=(checked_length == all_length);
            })
        })

      // 糖的全選
      var allsugar=document.getElementById("allsugar")
        allsugar.addEventListener("click",function (){
            var that=this
            var itemtwo=document.querySelectorAll("input.itemtwo")
            itemtwo.forEach(function (item,i){
                item.checked=that.checked

            })


        })

        var itemtwo=document.querySelectorAll("input.itemtwo")
        itemtwo.forEach(function (item,i){
            item.addEventListener("click",function (){
                var check_lenghttwo=document.querySelectorAll("input.itemtwo:checked").length;
                var all_lengthtwo=document.querySelectorAll("input.itemtwo").length

           allsugar.checked=(check_lenghttwo == all_lengthtwo);
            })
        })

        // 加料全選
        var allmaterials=document.getElementById("allmaterials")
        allmaterials.addEventListener("click",function (){
            var that=this
            var itemthree=document.querySelectorAll("input.itemthree")
            itemthree.forEach(function (item,i){
                item.checked=that.checked

            })


        })
        var itemthree=document.querySelectorAll("input.itemthree")
        itemtwo.forEach(function (item,i){
            item.addEventListener("click",function (){
                var check_lenghtthree=document.querySelectorAll("input.itemthree:checked").length;
                var all_lengththree=document.querySelectorAll("input.itemthree").length

                allmaterials.checked=(check_lenghtthree == all_lengththree);
            })
        })
        // =========獲取商品分類選項====
        const categorySelect = document.querySelector('.category');
        const categoryMessage = document.querySelector('.category-message');

        fetch('/categories/all')
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('分類加載失敗');
                }
            })
            .then(categories => {

                categorySelect.innerHTML = '';


                const defaultOption = document.createElement('option');
                defaultOption.text = '選擇一個分類';
                categorySelect.appendChild(defaultOption);


                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.text = category.categoryName;
                    categorySelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error loading categories:', error);
                categoryMessage.textContent = '加載失敗';
            });
        // =========驗證===============
            document.querySelector('form').addEventListener('submit', function(event) {
            event.preventDefault(); // 防止表單提交，進行驗證



            // 取得各個表單元素的值
            let productName = document.getElementById('productname').value.trim();
            let productPrice = document.getElementById('productprice').value;
            let productSize = document.getElementById('size').value;
            let productStatus = document.getElementById('status').value;
            let productPic = document.getElementById('productpic').files[0];
            let category = document.querySelector('.category').value;

            let iceOptions = document.querySelectorAll('.item');
            let sugarOptions = document.querySelectorAll('.itemtwo');
            let message=document.querySelector('.message');


            // 清空錯誤消息
            clearMessages();

            // 驗證邏輯，若有錯誤則返回
            if (!validateForm(productName, productPrice, productSize, productStatus, productPic, category, iceOptions, sugarOptions)) {
                return false;
            }

            // 準備要發送的數據
            let formData = new FormData();
            formData.append('productName', productName);
            formData.append('productPrice', productPrice);
            formData.append('productSize', productSize);
            formData.append('productStatus', productStatus);
            formData.append('category', category);

            // 添加商品圖片
            if (productPic) {
                formData.append('productPic', productPic);
            }

            // 添加冰塊調整選項
            iceOptions.forEach(option => {
                if (option.checked) {
                    formData.append('iceOptions', option.name);
                }
            });

            // 添加甜度調整選項
            sugarOptions.forEach(option => {
                if (option.checked) {
                    formData.append('sugarOptions', option.name);
                }
            })
                // 假設 store id=1
            // 發送fetch請求
            fetch(`/products/add/`, {
                method: 'POST',
                body: formData, // 發送FormData

            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('商品新增成功！');
                    } else {
                        alert('商品新增失敗: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('發送請求時出錯:', error);
                    alert('商品新增時發生錯誤');
                });
        });

        // // 表單驗證邏輯
        // function validateForm(productName, productPrice, iceOptions, sugarOptions) {
        //     // 驗證商品名稱
        //     if (productName === '' || productName.length > 50) {
        //         showError('productname', '商品名稱不能為空且不能超過50個字符');
        //
        //     }
        //
        //     // 驗證商品價格
        //     if (!productPrice || productPrice <= 0 || productPrice > 999) {
        //         showError('productprice', '商品價格必須介於1到999之間');
        //         return false;
        //     }
        //
        //     // 驗證商品圖片大小和格式
        //     if (productPic) {
        //         let fileSize = productPic.size / 1024 / 1024; // 文件大小（MB）
        //         let fileType = productPic.type;
        //         if (fileSize > 2) {
        //             showError('productpic', '圖片大小不能超過2MB');
        //             return false;
        //         }
        //         if (!['image/jpeg', 'image/png'].includes(fileType)) {
        //             showError('productpic', '僅支持JPEG或PNG格式的圖片');
        //             return false;
        //         }
        //     }
        //
        //     // 驗證冰塊調整
        //     if (!checkCheckboxSelected(iceOptions)) {
        //         showError('ice', '請至少選擇一種冰塊調整選項');
        //         return false;
        //     }
        //
        //     // 驗證甜度調整
        //     if (!checkCheckboxSelected(sugarOptions)) {
        //         showError('sugar', '請至少選擇一種甜度選項');
        //         return false;
        //     }
        //
        //     return true;
        // }
        //
        // // 顯示錯誤消息
        // function showError(fieldId, message) {
        //     document.querySelector(`.${fieldId}-message`).textContent = message;
        //     document.querySelector(`.${fieldId}-message`).style.color = 'red';
        // }
        //
        // // 清空所有錯誤消息
        // function clearMessages() {
        //     let errorMessages = document.querySelectorAll('span');
        //     errorMessages.forEach(function(message) {
        //         message.textContent = '';
        //     });
        // }
        //
        // // 檢查至少選擇了一個checkbox
        // function checkCheckboxSelected(checkboxes) {
        //     for (let i = 0; i < checkboxes.length; i++) {
        //         if (checkboxes[i].checked) {
        //             return true;
        //         }
        //     }
        //     return false;
        // }



    </script>




</body>






</html>