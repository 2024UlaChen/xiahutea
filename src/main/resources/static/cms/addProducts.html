<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>後台 | 商品資料</title>



    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="dist/css/adminlte.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="https://unpkg.com/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
    <style>
        img.preview {
            width: 300px;
            height: 350px;
        }

        ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        ul>li {
            display: inline-block;
            vertical-align: top;
        }



        .btn-info{
            background-color: #73B4BA;
            border-color: #73B4BA;
        }





    </style>


</head>

<body class="hold-transition sidebar-mini">

  <div class="wrapper">
    <div class="storeheader"></div>
    <div class="storeaside"></div>


      <div class="content-wrapper">
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1>商品資料</h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#">Home</a></li>
                            <li class="breadcrumb-item active">Projects</li>
                        </ol>
                    </div>
                </div>
            </div><!-- /.container-fluid -->
        </section>
        <section class="content">
            <div class="container-fluid">
                <div class="row justify-content-center">
                    <!-- left column -->
                    <div class="col-md-9">

                        <div class="card card-primary  mx-auto">

                            <!-- form start -->
                            <form id="productForm" enctype="multipart/form-data">
                                <div class="card-body">

                                    <div class="form-group">
                                        <label for="productName">商品名稱</label> <span style="color: red">*</span>
                                        <input type="text" class="form-control" id="productName" placeholder="請輸入商品名稱" name="productName">
                                    </div>
                                    <p class="productName-message" style="color: red"></p>
                                    <div class="form-group">
                                        <label for="productPrice">商品價格(請填台幣)</label><span style="color: red">*</span>
                                        <input type="number" class="form-control" id="productPrice" placeholder="65" name="productPrice" min="1" max="999">
                                    </div>
                                    <p class="productPrice-message" style="color: red"></p>

                                        <div class="form-group">
                                            <label for="size">商品尺寸</label>
                                            <select class="custom-select rounded-0" id="size" name="productsize">
                                            <option value="S">S</option>
                                            <option value="M">M</option>
                                            <option value="L">L</option>
                                        </select>

                                    </div>

                                    <div class="form-group">
                                        <label for="status">商品狀態</label>
                                        <span class="status-message" style="color: red"></span>
                                        <select class="custom-select rounded-0" id="status" name="productStatus">
                                            <option value="0">上架</option>
                                            <option value="1">下架</option>
                                        </select>
                                    </div>

                                    <div class="form-group">

                                        <label for="productPic">商品圖片</label>

                                        <div class="custom-file">
                                            <ul class="picture_list">

                                            </ul>
                                            <input type="file" class="custom-file-input" id="productPic" multiple>
                                            <label class="custom-file-label" for="productPic">選圖</label>
                                        </div>

                                    </div>
                                    <p class="productPic-message" style="color:red;"></p>


                                    <div class="form-group">
                                        <label>商品分類</label>
                                        <span class="category-message" style="color: red"></span>
                                        <select class="category" name="productCategoryId">

                                        </select>
                                    </div>
                                    <p class="category-message" style="color: red"></p>
                                    <div class="row">
                                        <span for="name" class="ice-message" style="color: red"></span>
                                        <div class="form-group col-4">

                                            <label class="form-check-label">冰塊調整</label><span style="color: red">*</span>


                                            <div class="form-check">
                                                <input type="checkbox" id="allice" >
                                                <label class="form-check-label">全選</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="item" type="checkbox" name="normalIce"
                                                    value="1" checked>
                                                <label class="form-check-label">正常冰</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="item" type="checkbox" name="lessIce"
                                                    value="1">
                                                <label class="form-check-label">少冰</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="item" type="checkbox" name="lightIce"
                                                    value="1">
                                                <label class="form-check-label">微冰</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="item" type="checkbox" name="iceFree"
                                                    value="1">
                                                <label class="form-check-label">去冰</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="item" type="checkbox" name="roomTemperature"
                                                    value="1">
                                                <label class="form-check-label">常溫</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="item" type="checkbox" name="hot" value="1">
                                                <label class="form-check-label">熱</label>
                                            </div>

                                        </div>

                                        <span class="sugar-message" style="color: red"></span>
                                        <div class="form-group col-4">
                                            <label fclass="form-check-label">甜度調整</label><span style="color: red">*</span>


                                            <div class="form-check">
                                                <input type="checkbox" id="allsugar" name="category">
                                                <label class="form-check-label">全選</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemtwo" type="checkbox" name="fullSugar" value="1" checked>
                                                <label class="form-check-label">全糖</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemtwo" type="checkbox" name="lessSugar"
                                                    value="1">
                                                <label class="form-check-label">少糖</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemtwo" type="checkbox" name="halfSugar"
                                                    value="1">
                                                <label class="form-check-label">半糖</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemtwo" type="checkbox" name="quarterSugar"
                                                    value="1">
                                                <label class="form-check-label">微糖</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemtwo" type="checkbox" name="noSugar" value="1">
                                                <label class="form-check-label">無糖</label>
                                            </div>
                                        </div>
                                        <div class="form-group col-4">
                                            <label class="form-check-label">加料</label>
                                            <div class="form-check">
                                                <input type="checkbox" id="allmaterials">
                                                <label class="form-check-label">全選</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemthree" type="checkbox" name="pearl" value="1">
                                                <label class="form-check-label">珍珠</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemthree" type="checkbox" name="pudding" value="1">
                                                <label class="form-check-label">布丁</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemthree" type="checkbox" name="coconutJelly" value="1">
                                                <label class="form-check-label">椰果</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemthree" type="checkbox" name="taro" value="1">
                                                <label class="form-check-label">芋圓</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="itemthree" type="checkbox" name="herbalJelly" value="1">
                                                <label class="form-check-label">仙草凍</label>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <button type="submit" class="btn btn-primary m-3 btn-info">新增商品</button>

                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                </div>
        </section>
      </div>
           <div class="storefooter"></div>

  </div>




    <script src="plugins/jquery/jquery.min.js"></script>
  <script src="js/storegeneral.js"></script>

    <script src="plugins/jquery-ui/jquery-ui.min.js"></script>
    <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
    <script src="plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="plugins/jquery-validation/jquery.validate.min.js"></script>
  <script src="plugins/jquery-validation/additional-methods.min.js"></script>
  <script src="dist/js/adminlte.js"></script>
  <script src="dist/js/demo.js"></script>
  <script src="https://unpkg.com/sweetalert2@11"></script>



  <script>
        <!--顯示商品圖-->
        var the_file = document.getElementById("productPic");
        the_file.addEventListener("change", function () {
            let ul_el = document.getElementsByClassName("picture_list")[0];
            ul_el.innerHTML = ""; // 清空現有的圖片列表

            let files = this.files;
            for (let i = 0; i < files.length; i++) {
                let reader = new FileReader();
                reader.readAsDataURL(files[i]);

                reader.addEventListener("load", function () {
                    let li_str = '';
                    li_str += '<li>';
                    li_str += '<img src="' + reader.result + '" class="preview" style="max-width: 350px; max-height: 350px; margin: 5px;">';
                    li_str += '</li>';
                    ul_el.insertAdjacentHTML("beforeend", li_str);
                });
            }
        })
       // 冰的全選
       var allice=document.getElementById("allice")
        allice.addEventListener("click",function (){
            var that=this
            var itemone=document.querySelectorAll("input.item")
            itemone.forEach(function (item,i){
                item.checked=that.checked
            })
        })

        var itemone=document.querySelectorAll("input.item");
        itemone.forEach(function (item,i){
            item.addEventListener("click",function (){
                var checked_length=document.querySelectorAll("input.item:checked").length;
                var all_length=document.querySelectorAll("input.item").length;

            allice.checked=(checked_length == all_length);
            })
        })

      // 糖的全選
      var allsugar=document.getElementById("allsugar")
        allsugar.addEventListener("click",function (){
            var that=this
            var itemtwo=document.querySelectorAll("input.itemtwo")
            itemtwo.forEach(function (item,i){
                item.checked=that.checked

            })


        })

        var itemtwo=document.querySelectorAll("input.itemtwo")
        itemtwo.forEach(function (item,i){
            item.addEventListener("click",function (){
                var check_lenghttwo=document.querySelectorAll("input.itemtwo:checked").length;
                var all_lengthtwo=document.querySelectorAll("input.itemtwo").length

           allsugar.checked=(check_lenghttwo == all_lengthtwo);
            })
        })

        // 加料全選
        var allmaterials=document.getElementById("allmaterials")
        allmaterials.addEventListener("click",function (){
            var that=this
            var itemthree=document.querySelectorAll("input.itemthree")
            itemthree.forEach(function (item,i){
                item.checked=that.checked

            })


        })
        var itemthree=document.querySelectorAll("input.itemthree")
        itemtwo.forEach(function (item,i){
            item.addEventListener("click",function (){
                var check_lenghtthree=document.querySelectorAll("input.itemthree:checked").length;
                var all_lengththree=document.querySelectorAll("input.itemthree").length

                allmaterials.checked=(check_lenghtthree == all_lengththree);
            })
        })
        // =========獲取商品分類選項====
        const categorySelect = document.querySelector('.category');
        const categoryMessage = document.querySelector('.category-message');

        fetch('/categories/all')
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('分類加載失敗');
                }
            })
            .then(categories => {

                categorySelect.innerHTML = '';


                const defaultOption = document.createElement('option');
                defaultOption.text = '選擇一個分類';
                categorySelect.appendChild(defaultOption);


                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.categoryId;
                    option.text = category.categoryName;
                    categorySelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error loading categories:', error);
                categoryMessage.textContent = '加載失敗';
            });
        // =========驗證===============
            document.getElementById('productForm').addEventListener('submit', function(event) {



                    event.preventDefault();
                    let productName = document.getElementById('productName').value.trim();
                    let productPrice = document.getElementById('productPrice').value;
                    let size = document.getElementById('size').value;
                    let productStatus = document.getElementById('status').value;
                    let productPic = document.getElementById('productPic').files[0];
                    let category = document.querySelector('.category').value;
                    let messagename=document.querySelector('.productName-message');
                    let messageprice=document.querySelector('.productPrice-message');
                    let messagecategory=document.querySelector('.category-message');


                   let isnormalIce=document.querySelector('input[name="normalIce"]').checked;
                    let islessIce=document.querySelector('input[name="lessIce"]').checked;
                     let islightIce=document.querySelector('input[name="lightIce"]').checked;
                     let isiceFree=document.querySelector('input[name="iceFree"]').checked;
                     let isroomTemperature=document.querySelector('input[name="roomTemperature"]').checked;
                     let ishot=document.querySelector('input[name="hot"]').checked;

                     let isfullSugar=document.querySelector('input[name="fullSugar"]').checked;
                    let islessSugar=document.querySelector('input[name="lessSugar"]').checked;
                    let ishalfSugar=document.querySelector('input[name="halfSugar"]').checked;
                    let isquarterSugar=document.querySelector('input[name="quarterSugar"]').checked;
                    let isnoSugar=document.querySelector('input[name="noSugar"]').checked;


                    let pearl=document.querySelector('input[name="pearl"]').checked;
                    let pudding=document.querySelector('input[name="pudding"]').checked;
                    let coconutJelly= document.querySelector('input[name="coconutJelly"]').checked;
                    let taro=document.querySelector('input[name="taro"]').checked;
                    let herbalJelly=document.querySelector('input[name="herbalJelly"]').checked;




                if (!productName) {
                   messagename.textContent='商品名稱不為空'
                    return false;
                }

                if (!productPrice || isNaN(productPrice) || parseFloat(productPrice) <= 0) {
                    messageprice.textContent='請輸入有效的金額'
                    return false;
                }

                if (!category) {
                    messagecategory.textContent='請選擇分類'
                    return false;
                }
                let v = {};

                let pictureInput = document.getElementById('productPic');
                let pictureInputFiles = '';
                if (pictureInput.files.length > 0) {

                    pictureInputFiles = pictureInput.files[0];
                }





                // 收集甜度調整
                let sugarOptions = {
                    fullSugar: document.querySelector('input[name="fullSugar"]').checked,
                    lessSugar: document.querySelector('input[name="lessSugar"]').checked,
                    halfSugar: document.querySelector('input[name="halfSugar"]').checked,
                    quarterSugar: document.querySelector('input[name="quarterSugar"]').checked,
                    noSugar: document.querySelector('input[name="noSugar"]').checked
                };
                productStatus= (productStatus=0 ? false : true);
                v = {
                    "productName": productName,
                    "productPrice": productPrice,
                    "productStatus": productStatus,
                    "productCategoryId": Number.parseInt(category),
                    "size": size,
                    "productPicture": pictureInputFiles,
                    "normalIce": isnormalIce,
                    "lessIce" : islessIce,
                    "lightIce" : islightIce,
                    "iceFree": isiceFree,
                    "roomTemperature": isroomTemperature,
                    "hot" : ishot,
                    "fullSugar":isfullSugar,
                    "lessSugar" : islessSugar,
                    "halfSugar" : ishalfSugar,
                    "quarterSugar" : isquarterSugar,
                    "noSugar" :isnoSugar,
                    "pearl" : pearl,
                    "pudding" : pudding,
                    "coconutJelly": coconutJelly,
                    "taro":taro,
                    "herbalJelly":herbalJelly
                };
                const Data = JSON.stringify(v);
                // 使用 fetch 發送 POST 請求
                fetch('/products/add', { // 確認路徑
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: Data
                }).then(response => {
                    if (!response.ok) {
                        throw new Error('网络响应不正常');
                    }
                    return response;
                })
                    .then(data => {
                        console.log('成功: ', data.status);
                    })
                    .catch((error) => {
                        console.error('错误: ', error);
                    });







            })


        /** 新增商品的方法 到後端 */


    </script>




</body>






</html>