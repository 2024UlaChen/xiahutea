<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>商家首頁</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/adminlte.min.css">
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
    <!-- 目前的icon是bootstrap icon, 需要cdn -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="./css/weien-chat.css">

</head>

<body class="hold-transition sidebar-mini layout-fixed" data-panel-auto-height-mode="height">
<div class="wrapper">

    <div class="storeheader"></div>
    <div class="storeaside"></div>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <div class="chat-container">
            <div id="weien-chat"></div>
        </div>
    </div>
    <!-- /.content-wrapper -->
    <div class="storefooter"></div>

</div>
<!-- ./wrapper -->
<!-- jQuery -->
<script src="plugins/jquery/jquery.min.js"></script>
<!--夏虎茶組件-->
<script src="js/storegeneral.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="plugins/jquery-ui/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->

<!-- Bootstrap 4 -->
<script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- overlayScrollbars -->
<script src="plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>

<script type="module">
    import { actionHandlers, WeienChat } from './js/weien-chat.js'
    let userTypeId;

    // 使用前須覆寫actionHandlers中必要的方法
    // 詳細可以去 weien-chat.js 中的 actionHandlers查看
    actionHandlers.getChatRoomsData = async () => {
        return await fetch("/chatroomdata")
            .then(res => res.json())
            .then(data =>{
                console.log(data);
                return data;
            })
    }

    actionHandlers.getChatMessagesData = async (chatId) => {

        return await fetch(`/chatmessagesdata/${chatId}`)
            .then(res => res.json())
            .then(ChatMessagesData =>{
                return ChatMessagesData;
            })
        // console.log('這裡是外部定義的getChatMessagesData chatId : ' + chatId);
        // 利用chatId去取得資料
        // 目前是傳入假資料
        // return chatId === 2 ? messages2 : messages;
    }

    actionHandlers.loadMoreChatRooms = async (type) => {
        // console.log(type);
        // type是指現在的過濾模式 (全部, 未讀, 置頂)
        // 目前是傳入假資料
        return chatRoomData;
    }

    actionHandlers.loadMoreMessages = async () => {
        // 目前是傳入假資料
        return messages;
    }

    actionHandlers.getUID = async () => {

        return await fetch("/totalusers")
            .then(res => res.json())
            .then(data =>{
                userTypeId = data.userTypeId;
                return data.totalUserId;
            })
    }

    const chat = new WeienChat();

    document.addEventListener('DOMContentLoaded', async () => {
        // 加載完成以後啟動
        await chat.init();
        if (userTypeId !== 3){
            chat.state.value.showMode = 'mobile'
        }
        chat.state.value.activeChatId = 1;
    });

</script>

</body>
</html>
