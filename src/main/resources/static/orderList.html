<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的訂單</title>
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png" />
    <link
            href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i&display=swap"
            rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <link rel="stylesheet" href="assets/css/jquery-ui.css">
    <link rel="stylesheet" href="assets/css/slick.css">
    <link rel="stylesheet" href="assets/css/chosen.min.css">
    <link rel="stylesheet" href="assets/css/pe-icon-7-stroke.css">
    <link rel="stylesheet" href="assets/css/magnific-popup.min.css">
    <link rel="stylesheet" href="assets/css/lightbox.min.css">
    <link rel="stylesheet" href="assets/js/fancybox/source/jquery.fancybox.css">
    <link rel="stylesheet" href="assets/css/jquery.scrollbar.min.css">
    <link rel="stylesheet" href="assets/css/mobile-menu.css">
    <link rel="stylesheet" href="assets/fonts/flaticon/flaticon.css">
    <link rel="stylesheet" href="assets/css/style.css">

<!--    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">-->


    <style>
        /* background-color: #f5f5f5; */
        /* header  & footer */
        div.header-message>h1 {
            margin: 0 auto;
            border-radius: 50%;
            color: #73B4BA;
        }
        .header-user-links li {
            display: inline-block;
        }
        .header-user-links i {
            border-radius: 50%;
            font-size: 20px;
            margin-left: 10px;
        }
        .query-bar a {
            margin-left: 10px;
            margin-right: 10px;
            border-radius: 50%;
        }
        .query-bar input {
            background-color: white;
            width: 80%;
        }
        #query-member {
            min-width: 200px;
            padding-left: 10px;
        }
        #query-member li {
            min-width: 100%;
        }
        #query-member img {
            width: 100%;
        }
        #query-member .account-list {
            margin-top: 10%;
        }
        .reset-margin {
            margin: 0;
            margin-top: 2%;
            background-color: #f5f5f5;
        }
        .member-aside {
            width: 30%;
            height: 100%;
            margin: 0 auto;
            /* background-color: #f8f8f8; */

        }
        .member-introduction {
            margin: 0 auto;
            margin-right: 30px;
            padding-top: 55px;
            padding-right: 20px;
            padding-bottom: 45px;
            padding-left: 20px;
            background-color: white;
        }
        .member-introduction div {
            text-align: center;
            overflow: hidden;
        }
        .member-list {
            margin-right: 30px;
            margin-top: 50px;
            padding-top: 55px;
            padding-right: 20px;
            padding-bottom: 50px;
            padding-left: 60px;
            background-color: white;
        }
        .member-list li {
            height: 60px;
            font-size: 18px;
            text-align: left;
            list-style-type: none;
        }
        .warn {
            display: inline;
            color: #ff5e7d;
        }
        .remind {
            color: #9b9b9b;
            font-size: 12px;
        }
        .userPhoto {
            margin: 0 auto;
            display: inline-block;
            width: 30%;
            border-radius: 50%;
        }
        .sex {
            font-size: 16px;
            display: block;
        }


        /* main區塊 */
        .left-sidebar .content-area{
            float: left;
            width: 100%;
        }
        .shop-top-control{
            width: 100%;
            margin-top: 10px;
            border-radius: 5px;
        }

        /* 查詢欄 */
        /*  select訂單狀態*/
        input[type="text"], input[type="email"], input[type="password"], input[type="tel"], input[type="search"], input[type="url"], textarea, select{
            background-color: white;
            height: 40px;
            width: 150px;
            color: black;
            border-radius: 5px;
            border: 1px solid #DFF3F7;
        }
        input.select_date{
            width: 150px;
            font-weight: normal;
            text-align: center;
            height: 40px;
            color: black;
            border-radius: 5px;
            border: 1px solid #DFF3F7;
        }
        span.title{
            margin: 20px;
            color: black;
        }

        /* 查詢btn */
        #select_btn{
            width: 100px;
            height: 40px;
            background-color: #F8F9FA;
            border: 1px solid #73B4BA;
            line-height: 20px;
            font-size: 16px;
            color: #53a0a7;
            border-radius: 5px;
        }

        /* 訂單卡*/
        .product-item .product-inner {
            border-radius: 20px;
        }
        div.one_order_list{
            border-bottom: 1px #e4e4e48e solid;
            width: 100%;
            height: 200px;
        }
        div.one_order_list_circle{
            display: inline-block;
            margin-top: 50px;
            width: 100px;
            height: 100px;
            line-height:180px ;
            border-radius: 50%;
            overflow: hidden;
        }
        img.store_logo{
            object-fit:cover;
            width: 100%;
            height: 100%;
            vertical-align:baseline ;
        }
        div.one_order_store_name span{
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            line-height: 2;
            color: black;
        }
        div.order_detail>span{
            color: black;
            font-size: 14px;
        }
        div.order_price>span{
            color: black;
            font-size: 18px;
            font-weight: bold;
        }
        div.order_time>span{
            color: black;
            font-size: 12px;
            line-height: 2;
        }
        ul.order_list_ul{
            display:  inline;
        }
        .left-sidebar .content-area{
            float: left;
            width: 100%;
        }
        span.title{
            margin: 20px;
        }
        .order_id{
            display: none;
        }

        .one_order_status{
            width: 100%;
            height:100px;
        }
        span.one_order_status_text{
            font-size: 28px;
            color: white;
            font-weight: bold;
            text-align: center;
            line-height:100px ;
        }

        /* 訂單狀態 更改css */
        div.one_order_status.incomplete{
            background-color: #FAC792;
        }
        div.one_order_status.complete{
            background-color: #73B4BA;
        }

        /* 爭議狀態 */
        div.dispute_status_div.-close{
            display: none;
        }
        ul.order_list_ul{
            display:  inline;
        }

    </style>
</head>

<body>
<div class="header"></div>
<div class="main-content main-content-product left-sidebar">
    <div class="container">
        <div class="row">
            <div class="content-area shop-grid-content no-banner col-lg-9 col-md-9 col-sm-12 col-xs-12">
                <div class="site-main" style="width: 100%">
                    <!-- 查詢區塊 -->
                    <div class="shop-top-control">
                        <form class="select-item select-form" id="order_status">
                            <span class="title">訂單狀態</span>
                            <select title="sort" data-placeholder="12 Products/Page" class="select_status">
                                <option value="" selected>請選擇</option>
                                <option value="訂單成立">訂單成立</option>
                                <option value="準備完成">準備完成</option>
                                <option value="正在外送">正在外送</option>
                                <option value="訂單完成">訂單完成</option>
                            </select>
                        </form>
                        <form class="select-item select-form" >
                            <span class="title">訂單日期</span>
                            <label>
                                <input class="select_date" type="date">
                            </label>
                            <span> ~ </span>
                            <label>
                                <input class="select_date" type="date">
                            </label>
                        </form>
                        <form class="select-item select-form" >
                            <button  id="select_btn">查詢</button>
                        </form>
                    </div>
                    <!-- 訂單區塊 -->
                    <ul class="row list-products auto-clear equal-container product-grid order_list_ul">
                    <!--  JS放入訂單資料  -->
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="footer"></div>

<script src="assets/js/jquery-1.12.4.min.js"></script>
<script src="assets/js/jquery.plugin-countdown.min.js"></script>
<script src="assets/js/jquery-countdown.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/owl.carousel.min.js"></script>
<script src="assets/js/magnific-popup.min.js"></script>
<script src="assets/js/isotope.min.js"></script>
<script src="assets/js/jquery.scrollbar.min.js"></script>
<script src="assets/js/jquery-ui.min.js"></script>
<script src="assets/js/mobile-menu.js"></script>
<script src="assets/js/chosen.min.js"></script>
<script src="assets/js/slick.js"></script>
<script src="assets/js/jquery.elevateZoom.min.js"></script>
<script src="assets/js/jquery.actual.min.js"></script>
<script src="assets/js/fancybox/source/jquery.fancybox.js"></script>
<script src="assets/js/lightbox.min.js"></script>
<script src="assets/js/owl.thumbs.min.js"></script>
<script src="assets/js/jquery.scrollbar.min.js"></script>
<script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyC3nDHy1dARR-Pa_2jjPCjvsOR4bcILYsM'></script>
<script src="assets/js/frontend-plugin.js"></script>
<!--<script src="assets/js/newjs.js"></script>-->
<script src="./js/general.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function(){

        // 1.查詢欄
        // 1.1 輸入訂單狀態 & 訂單日期，點查詢btn可篩選訂單
        let btn_select = document.getElementById("select_btn");
        btn_select.addEventListener("click", function (e) {

            e.preventDefault();
            let select_order_status_el = document.getElementsByClassName("select_status")[0];
            let select_order_date1_el = document.getElementsByClassName("select_date")[0];
            let select_order_date2_el = document.getElementsByClassName("select_date")[1];
            let select_order_status = select_order_status_el.value || "";
            let select_order_date1 = select_order_date1_el.value || "";
            let select_order_date2 = select_order_date2_el.value || "";
            let order_rows = document.querySelectorAll("ul.list-products li.product-item");

            order_rows.forEach(row => {
                // 檢查是否存在所有需要的元素
                let order_status_el = row.getElementsByClassName("one_order_status_text")[0];
                let order_date_el = row.getElementsByClassName("order_date_value")[0];

                if (!order_status_el || !order_date_el) {
                    return; // 跳過此列
                }
                // 取得訂單列表資料
                let order_status = order_status_el.innerText;
                let order_date = order_date_el.innerText;

                let show_row = true;

                // 篩選條件
                if (select_order_status && order_status !== select_order_status) {
                    show_row = false;
                }

                //todo: 待資料庫完成後，再處理時區問題
                if (select_order_date1 && select_order_date2) {
                    let order_date_obj = new Date(order_date.replace(/-/g,'/'));
                    let date1 = new Date(select_order_date1);
                    let date2 = new Date(select_order_date2);

                    if (order_date_obj < date1 || order_date_obj > date2) {
                        show_row = false;
                    }
                }
               // 顯示或隱藏該列
               row.style.display = show_row ? "" : "none";
          });
        });


        // ==========================================================================
        // 2.訂單列表
        // 2.1 抓訂單資料 TODO 待串接後端DB
        const orders = [
            {
                order_status: "正在外送",
                store_logo: "https://placehold.co/200x200",
                store_name: "一沐日永和店",
                order_id: "2408010002", // 如果有具體編號，替換這裡
                items: 5,
                total_price: 245,
                order_date: "2024/07/20 18:11",
                dispute_status: "已同意申請"
            },
            {
                order_status: "準備完成",
                store_logo: "https://placehold.co/200x200",
                store_name: "50嵐新莊店",
                order_id: "2409010002", // 如果有具體編號，替換這裡
                items: 5,
                total_price: 245,
                order_date: "2024/07/20 18:11",
                dispute_status: "" // 無爭議狀態
            },
            {
                order_status: "準備完成",
                store_logo: "https://placehold.co/200x200",
                store_name: "一沐日永和店",
                order_id: "2408050002", // 如果有具體編號，替換這裡
                items: 5,
                total_price: 245,
                order_date: "2024/07/20 18:11",
                dispute_status: "已同意申請"
            },
            {
                order_status: "訂單完成",
                store_logo: "https://placehold.co/200x200",
                store_name: "一沐日永和店",
                order_id: "2408010052", // 如果有具體編號，替換這裡
                items: 5,
                total_price: 245,
                order_date: "2024/08/20 18:11",
                dispute_status: "" // 無爭議狀態
            },
            {
                order_status: "訂單成立",
                store_logo: "https://placehold.co/200x200",
                store_name: "一沐日永和店",
                order_id: "2408010452", // 如果有具體編號，替換這裡
                items: 5,
                total_price: 245,
                order_date: "2024/09/20 18:11",
                dispute_status: "" // 無爭議狀態
            }
        ];

        let orderHtml = "";
        for(let i = 0; i < orders.length ; i++){
            // 2.1.2 有爭議訂單時，則顯示爭議狀態文字
            let dispute_status_div = document.getElementsByClassName("dispute_status_div")[0];
            console.log(dispute_status_div)
            const disputeClass = orders[i].dispute_status === "" ? "-close" : "";
            //    const disputeClass = orders[i].closest(".dispute_status_div") === "" ? "-close" : "";

            // 2.1.3 訂單狀態不同 更改不同顏色
            let statusClass = "";
            switch (orders[i].order_status) {
                case "訂單成立":
                case "正在外送":
                case "準備完成":
                    statusClass = "incomplete";  // 橘色
                    break;
                case "訂單完成":
                    statusClass = "complete";  // 藍色
                    break;
            }

            orderHtml += `
                <li class="product-item  col-lg-4 col-md-6 col-sm-6 col-xs-6 col-ts-12 style-1">
                    <div class="product-inner equal-element">
                        <div class="product-thumb">
                            <div class="thumb-inner" >
                                <a href="#">
                                    <div>
                                        <div class="one_order_status  ${statusClass}" >
                                            <span class="one_order_status_text">${orders[i].order_status}</span>
                                        </div>
                                        <div class="one_order_list">
                                            <div class="one_order_list_circle">
                                                <img class="store_logo" src=${orders[i].store_logo} alt="店家logo">
                                            </div>
                                            <div class="one_order_store_name">
                                                <span>${orders[i].store_name}</span>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="product-info">
                            <div class="group-info">
                                <div class="order_id">
                                    <span>${orders[i].order_id}</span>
                                </div>
                                <div class="order_detail">
                                    <span>${orders[i].items} 項商品</span>
                                </div>
                                <div class="order_price">
                                    <span>共 ${orders[i].total_price} 元</span>
                                </div>
                                <div class="order_time">
                                    <span class="order_date_value">${orders[i].order_date}</span>
                                </div>
                                <div class="order_time dispute_status_div" ${disputeClass} >
                                    <span>爭議狀態： ${orders[i].dispute_status}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            `;
        }
        document.getElementsByClassName("order_list_ul")[0].innerHTML = orderHtml;


        // 2.3 點擊訂單卡片 link訂單明細
        // todo: 待後端完成 check 變數
        let order_arr = document.querySelectorAll("div.product-inner");
        for(i = 0; i < order_arr.length; i++ ){
            let order_item = document.getElementsByClassName("product-inner")[i];
            order_item.addEventListener("click", function(){
                location.href = "orderDetail.html";
                //待後端完成 check變數連結
            });
        }
    });
</script>
</body>
</html>