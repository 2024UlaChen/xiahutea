<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">


    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png"/>
    <link
            href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i&display=swap"
            rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <link rel="stylesheet" href="assets/css/jquery-ui.css">
    <link rel="stylesheet" href="assets/css/slick.css">
    <link rel="stylesheet" href="assets/css/chosen.min.css">
    <link rel="stylesheet" href="assets/css/pe-icon-7-stroke.css">
    <link rel="stylesheet" href="assets/css/magnific-popup.min.css">
    <link rel="stylesheet" href="assets/css/lightbox.min.css">
    <link rel="stylesheet" href="assets/js/fancybox/source/jquery.fancybox.css">
    <link rel="stylesheet" href="assets/css/jquery.scrollbar.min.css">
    <link rel="stylesheet" href="assets/css/mobile-menu.css">
    <link rel="stylesheet" href="assets/fonts/flaticon/flaticon.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="https://unpkg.com/sweetalert2@11/dist/sweetalert2.min.css">


    <style>
        * {
            box-sizing: border-box;
        }

        body {
            /*background-color: #d1eced;*/
            background: #F5F5F5;


        }

       .bigcontainer {
           display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
       }

        .restaurant-info-container,
        .menu-container {
            width: 80%;
            margin-bottom: 20px;


        }



        .restaurant-info-container {

            box-shadow: 0px 2px 4px -1px rgb(227, 219, 219);
            margin-top: 10px;
            border-radius: 10px;
            background-color: #ffffff;


        }

        @media (max-width: 992px) {
            .restaurant-info-container {

              width: 800px;

            }
        }

        .restaurant-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .restaurant-details {
            display: flex;
            flex-direction: column;

            border-radius: 10px;




        }
        .rating,
        .hours,
        .phone,
        .address {
            margin-top: 5px;
        }

        .restaurant-text {
            display: flex;
            flex-direction: column;

        }

        .restaurant-actions {
            display: flex;
            justify-content: space-around;
            margin-top: 50px;



        }

        .action {
            /* display: inline-block; */
            margin-top: 10px;



        }

        .restaurant-logo-big {
            text-align: center;
        }

       div.menu-section {

            width: 30%;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0px 2px 4px -1px rgb(227, 219, 219);
            border: 1px solid #00000020;
            background-color: #ffffff;
            flex-grow: 1;
        }

        .menu-container {
            display: flex;
            flex-wrap: wrap;
            text-align: left;
            gap: 37px;



            /* 使整個 menu-container 的內容靠左對齊 */
        }

        @media (max-width: 992px) {
            .menu-container {

                width:800px;

            }
        }



        .menu-section ul {
            list-style: none;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 5px;




        }

        .menu-section li {
            margin-bottom: 10px;
            border-bottom: 1px dotted #ccc;
            color: #0a0601;
            display: flex;
            justify-content: space-between;
            cursor: pointer;
        }

        h2 {

            color: #73B4BA;
            margin-bottom: 10px;
            text-align: center;
        }



        .restaurant-info-container {
            display: flex;
            flex-wrap: wrap;
        }

        .restaurant-details {
            flex: 1;
            min-width: 300px;
            padding: 20px;
        }


        .carousel-inner img {
            width: 100%;
            height: auto;
        }



        div.orderinfo,
        div.question {

            background-color: #fac792;
            border-radius: 10px;
            width: 100px;
            height: 50px;
            box-shadow: 0px 2px 4px -1px rgb(232, 196, 196);
            cursor: pointer;
            display: flex;
            /* 水平置中 */
            justify-content: center;
            /* 垂直置中 */
            align-items: center;


        }


        div.orderinfo:hover {
            background-color: #73B4BA;
        }

        div.question:hover {
            background-color: #73B4BA;

        }


        /* 燈箱 */
        #lightbox {
            /*   border: 1px solid red; */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: hsla(0, 0%, 0%, .5);


            display: none;
        }

        /* 元素 article 置中及基本樣式 */
        #lightbox>article {

            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);

            background-color: white;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;

            max-width: 380px;

        }


        div.title {
            /* padding: 15px; */
            /* font-weight: bold; */
            background-color: #ffffff;
            text-align: center;


        }

        div.content {
            /* padding: 15px; */
            overflow: auto;
            flex-grow: 1;
            height: 400px;

            /* 讓中間部分填充剩餘空間 */
        }

        div.bottom {
            padding: 10px;
            background-color: #f8f8f8;

        }

        .content::-webkit-scrollbar {
            display: none;
        }




        div.options div.temperature,div.sweetness,div.topping,div.size {

            border-radius: 5px;
            border: solid #fac792 1px;
        }


        div.options {
            margin-left: 10px;



        }

        div.temperature {
            display: flex;
            width: 90px;
            height: 30px;
            margin-right: 10px;
            margin-bottom: 10px;
            /* 水平置中 */
            justify-content: center;
            /* 垂直置中 */
            align-items: center;
            cursor: pointer;

        }


        div.sweetness {
            display: flex;
            width: 90px;
            height: 30px;
            margin-right: 10px;
            margin-bottom: 10px;
            /* 水平置中 */
            justify-content: center;
            /* 垂直置中 */
            align-items: center;
            cursor: pointer;

        }

        div.topping {
            display: flex;
            width: 90px;
            height: 30px;
            margin-right: 10px;
            margin-bottom: 10px;
            /* 水平置中 */
            justify-content: center;
            /* 垂直置中 */
            align-items: center;
            cursor: pointer;

        }

         div.size {

            display: flex;
            width: 90px;
            height: 30px;
            margin-right: 10px;
            margin-bottom: 10px;
            /* 水平置中 */
            justify-content: center;
            /* 垂直置中 */
            align-items: center;
            cursor: pointer;


        }


        .section {

            margin-bottom: 20px;
            justify-content: center;
            margin: 10px;

        }

        .section label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .options {
            display: flex;

            flex-wrap: wrap;
        }

        /* 字體顏色 */
        div.ice {
            color: rgb(69, 64, 64);
            font-size: x-small;
        }




        /* 數量 */
        /* selector */
        input.minus,
        input.plus {
            width: 40px;
            height: 32px;
            border: solid #fac792 1px;
            /* 水平置中 */
            justify-content: center;
            /* 垂直置中 */
            align-items: center;
            display: flex;
            background-color: #fff;


        }

        .minus {
            border-radius: 5px 0px 0px 5px;
        }

        .plus {
            border-radius: 0px 5px 5px 0px;
        }

        div.selector {
            border: solid #fac792 1px;
            width: 87px;
            height: 32px;

        }

        div.quantity {
            display: flex;
            justify-content: flex-start;
        }

        input.number {
            width: 85px;
            height: 25px;
            outline: none;
            text-align: center;

        }

        /* 訂購人 */
       input.person {
            border: solid #fac792 1px;
            border-radius: 5px;
            width: 200px;
            height: 30px;

        }


        /* .myclassa {
            border: 1px solid black;
            display: inline-block;
        }

        .myclassa img {
            border: 1px solid blue;
        } */

        .bottom {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .bottom button[type="submit"] {
            background-color: #28a745;
            color: #fff;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 20px;
            /* display: inline; */
            align-items: center;


        }

        .bottom button[type="submit"]:hover {
            background-color: #218838;
        }



        div.pic {
            width: 350px;
            height: 300px;
            /* border: solid red 1px; */
        }

        div.pic img {

            /* width: 100%;
            height: 100%; */
            vertical-align: bottom;
            width: 100%;
        }

        /* 訂購資訊modal */

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        /* Modal Content */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 70%;
            max-width: 500px;
            border-radius: 5px;

        }

        /* Close Button */
        .close {
            color:grey;
             margin-left: auto;
            padding-right:4px;

            font-size: 28px;
            font-weight: bold;

        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Modal Header */
        .modal-header {
            display: flex;
            justify-content: flex-start;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }

        /* Modal Tabs */
        .modal-tabs {
            display: flex;
            /*justify-content: flex-start;*/
            margin-bottom: 10px;
        }

        .modal-tabs div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            display: block;
        }

        .modal-tabs div.active {
            border-bottom: 2px solid #fac792;
            font-weight: bold;
        }

        /* Modal Sections */
        .modal-section {
            display: none;
        }

        .modal-section.active {
            display: block;
        }

        /* Delivery Options */
        .delivery-options {
            margin-top: 20px;
        }

        .delivery-options ul {
            list-style-type: none;
            padding: 0;

        }

        .delivery-options li {
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }
        .section-content {
            margin-bottom: 20px;
        }
        #deliveryOptions h5 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #ff6600;
        }

        #adImage {
            max-width: 100%; /* 使图像自适应父元素宽度 */
            height: auto;    /* 保持宽高比 */
        }

    </style>
</head>

<body>

<div class="header"></div>

 <div class="bigcontainer">
    <div class="restaurant-info-container">
        <div class="restaurant-info">
            <div class="restaurant-details">

                <div class="restaurant-text">

                    <h4 class="storeName"></h4>
                    <div class="rating">
                        <span span id="storeRating"></span>

                    </div>
                    <div class="hours">
                        <i class="fa-solid fa-business-time"></i><span id="openHours"></span>~<span id="closingHours"></span>
                    </div>
                    <div class="phone">
                        <i class="fa-solid fa-phone"></i><span id="storePhone"></span>
                    </div>
                    <div class="address">
                        <i class="fa-sharp-duotone fa-solid fa-map-location-dot"></i>
                        <span class="storeAddress"></span>
                    </div>
                </div>

                <div class="restaurant-actions">
                    <div class="orderinfo" style="color: #fffcfc;">訂購資訊</div>
                    <div class="question" style="color: #ffffff;">常見問題</div>

                </div>
            </div>


            <div class="myclass">
                <img id="adImage" src="" alt="Advertisement Image" />

            </div>

        </div>

    </div>

    <!-- 訂購資訊 -->
    <div id="myModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <div>
            <span class="close">&times;</span>
            <h3>訂購資訊</h3>
            </div>
            <div class="modal-header">
                <div class="modal-tabs">
                    <div class="active">店家資訊</div>
                    <div>怎取貨</div>

                </div>

            </div>

            <!-- Modal Sections -->
            <div id="storeInfo" class="modal-section active">

                <div class="storeName">康青龍 新店寶強店</div>
                <span>⭐⭐⭐⭐⭐</span><span class="score"></span>

                <div><i class="fa-solid fa-business-time"></i><span class="open"></span>~<span class="closing"></span></div>
                <div><i class="fa-solid fa-phone"></i><span class="phone">02-2914-8066</span></div>
                <div><i class="fa-sharp-duotone fa-solid fa-map-location-dot"></i><span class="address"></span></div>

                <div class="vat">66309280</div>

            </div>
            <div id="deliveryOptions" class="modal-section">
                <h5>訂購說明</h5>
                <div class="section-content">
                   滿 <span class="delivery"></span>可外送
                </div>


                <h5>取貨方式</h5>
                <div class="section-content">
                    <span class="isdelivery"><strong>外送</strong></span><br>
                    營業期間都可下單
                </div>
            </div>

        </div>

    </div>

    <div class="menu-container ">

    </div>



    <!-- 燈箱 (飲料點選)-->
    <div id="lightbox">
        <article>
            <span class="close">&times;</span>
            <div class="title">

                <h6 id="productTitle">大●阿薩姆紅茶</h6>
            </div>
            <form>
                <div class="content">
                  <div class="pic">
                      <img id="productImage" alt="Product Image" src=""/>
                   </div>

                    <div class="section">
                        <label><span style="color: red;">*</span>尺寸</label>
                        <div id="sizeOptions" class="options">
                            <div class="size">
                                S
                            </div>
                        </div>
                    </div>
                    <div class="section">
                        <label><span style="color: red;">*</span>溫度</label>
                        <div id="temperatureOptions" class="options">
                            <div  class="temperature">
                                正常冰
                            </div>
                            <div class="temperature">
                                少冰
                            </div>
                            <div class="temperature">
                                去冰
                            </div>
                            <div class="temperature">
                                微冰
                            </div>
                            <div class="temperature">
                                常溫
                            </div>
                            <div class="temperature">
                                熱
                            </div>
                        </div>
                    </div>
                    <div class="section">
                        <label><span style="color: red;">*</span>甜度</label>
                        <div id="sweetnessOptions" class="options">
                            <div class="sweetness">
                                全糖
                            </div>
                            <div class="sweetness">
                                少糖
                            </div>
                            <div class="sweetness">
                                半糖
                            </div>
                            <div class="sweetness">
                                微糖
                            </div>
                            <div class="sweetness">
                                無糖
                            </div>

                        </div>
                    </div>
                    <div class="section">
                        <label><span style="color: red;">*</span>加料</label>
                        <div id="toppingsOptions" class="options">
                            <div class="topping">
                                珍珠
                            </div>
                            <div class="topping">
                                布丁
                            </div>
                            <div class="topping">
                                椰果
                            </div>
                            <div class="topping">
                                芋園
                            </div>
                            <div class="topping">
                                仙草
                            </div>

                        </div>
                    </div>

                </div>


                <div class="bottom">
                    <div class="result">


                        <div class="price">
                           <div>總金額： <span id="totalAmt">70</span>元</div>

                        </div>

                        <div class="quantity">
<!--                            <button class="minus"><i class="fa-solid fa-minus"></i></button>-->
                            <input type="button" value="-" class="minus">
                            <div class="selector">
                                <input type="number" class="number" min="1" id="buyNum" max="999" value="1"
                                       style="border: none;">
                            </div>
                                <input type="button" value="+" class="plus">
<!--                            <button type="button" class="plus"><i class="fa-solid fa-plus"></i></button>-->
                            </div>
                    </div>
                    <div class="test">
                        <button type="submit" id="addToCartButton">加入購物車</button>
                    </div>
                </div>
            </form>
        </article>
    </div>
 </div>


    <div class="footer"></div>
    <script src="https://kit.fontawesome.com/b0f5b7d33a.js" crossorigin="anonymous"></script>
    <script src="assets/js/jquery-1.12.4.min.js"></script>
    <script src="assets/js/jquery.plugin-countdown.min.js"></script>
    <script src="assets/js/jquery-countdown.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/owl.carousel.min.js"></script>
    <script src="assets/js/magnific-popup.min.js"></script>
    <script src="assets/js/isotope.min.js"></script>
    <script src="assets/js/jquery.scrollbar.min.js"></script>
    <script src="assets/js/jquery-ui.min.js"></script>
    <script src="assets/js/mobile-menu.js"></script>
    <script src="assets/js/chosen.min.js"></script>
<!--    <script src="assets/js/slick.js"></script>-->
    <script src="assets/js/jquery.elevateZoom.min.js"></script>
    <script src="assets/js/jquery.actual.min.js"></script>
    <script src="assets/js/fancybox/source/jquery.fancybox.js"></script>
    <script src="assets/js/lightbox.min.js"></script>
    <script src="assets/js/owl.thumbs.min.js"></script>
    <script src="assets/js/jquery.scrollbar.min.js"></script>
    <script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyC3nDHy1dARR-Pa_2jjPCjvsOR4bcILYsM'></script>
    <script src="assets/js/frontend-plugin.js"></script>
    <!--<script src="assets/js/newjs.js"></script>-->
    <script src="./js/general.js"></script>

<script src="https://unpkg.com/sweetalert2@11"></script>




<script>
// <!-- http://localhost:8080/productMenu.html?storeId=1-->
    const urlParams = new URLSearchParams(window.location.search);
    const storeId = urlParams.get('storeId'); // 这里获取的是 'storeId' 参数的值
    const storeIdNum = parseInt(storeId); // 将字符串转换为数字


// 用 fetch 獲取 TotalUserDTO 並檢查用戶是否登入

// 加入購物車的功能 (根據實際情況替換邏輯)



if (isNaN(storeIdNum)) {
    console.error('无效的店家 ID'); // 处理无效的店家 ID
} else {
    // Fetch 店家信息
    fetch(`/store/getInfo/${storeIdNum}`) // 根据你的后端 API 结构调整路径
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(store => {
            console.log('店家信息:', store);
            document.querySelector('.storeName').textContent = store.storeName
            document.getElementById('openHours').textContent=store.openingHours;
            document.getElementById('closingHours').textContent=store.closingHours;
            document.getElementById('storePhone').textContent=store.storePhone;
            document.querySelector('.storeAddress').textContent=store.storeAddress;
            document.querySelector('div.storeName').textContent=store.storeName;
            document.querySelector('span.score').textContent=store.score;
            document.querySelector('.open').textContent=store.openingHours;
            document.querySelector('.closing').textContent=store.closingHours;
            document.querySelector('span.phone').textContent=store.storePhone;
            document.querySelector('span.address').textContent=store.storeAddress;
            document.querySelector('span.delivery').textContent=store.deliveryMoney;
            document.querySelector('.vat').textContent=store.vat;

            const isDelivery = document.querySelector('.isdelivery');
            if (store.isDelivery) {
                isDelivery.textContent = "此商品可提供外送服務";
            } else {
                isDelivery.textContent = "此商品不提供外送服務";
            }
        })
        .catch(error => {
            console.error('Error fetching store information:', error);
        });


    fetchProductsAndCategories(storeIdNum); // 调用函数以获取产品和类别信息
}



    // Construct the URL for the image based on the product ID
    const img = document.getElementById('adImage');
    img.src ='';

    const url = `products/advertise/image/${storeIdNum}`;  // Adjust the URL according to your API endpoint

    // Use fetch to get the image
    fetch(url)
        .then(response => {
            if (response.ok) {
                return response.text(); // 將回應解析為文本，也就是Base64字符串
            } else {
                throw new Error('Image not found');
            }
        })
        .then(base64Image => {
            // 將Base64圖片插入到img標籤中
            img.src = `data:image/png;base64,${base64Image}`;
        })
        .catch(error => {
            console.error('Error fetching the image:', error);
        });


$('#add').on('click',function (){
        window.location.href="addProducts.html"
    })




    $("div.orderinfo").on('click', function () {
        $("#myModal").fadeIn();
    });

    $("span.close").on("click", function () {
        $("#myModal").fadeOut();
        $("#lightbox").fadeOut();

    })


    // 兩個切換按鈕的按鈕
    var $tabs = $('.modal-tabs div');
    var $sections = $('.modal-section');

    $tabs.on('click', function () {
        $tabs.removeClass('active');
        $sections.removeClass('active');

        var index = $(this).index();

        $(this).addClass('active');
        $sections.eq(index).addClass('active');
    });


    // 常見問題
    $("div.question").on("click", function () {
        location.href = "faq.html"

    });




    function fetchProductsAndCategories(storeId) {

        fetch(`/categories/store/${storeId}`)
            .then(response => response.json())
            .then(categories => {
                // 遍歷每個分類，獲取相應的產品
                categories.forEach(category => {

                    if (category.categoryStatus === false) { // 如果分类状态为'下架'
                        return; // 跳过该分类，连同该分类下的产品都不处理
                    }

                    fetch(`/products/byCategory?ProductCategoryId=${category.categoryId}`)
                        .then(response => response.json())
                        .then(products => {
                            // 顯示產品
                            displayProducts(category.categoryName, products);
                        })
                        .catch(error => {
                            console.error('Error fetching products:', error);
                        });
                });
            })
            .catch(error => {
                console.error('Error fetching categories:', error);
            });

       }





var productId;
    // 顯示產品的函數
    function displayProducts(categoryName, products) {
        const menuContainer = document.querySelector('.menu-container');

        // 創建 menu section
        const section = document.createElement('div');
        section.classList.add('menu-section');

        // 添加 h2 標籤
        const h2 = document.createElement('h2');
        h2.textContent = categoryName;
        section.appendChild(h2);

        // 創建 ul 元素
        const ul = document.createElement('ul');
        ul.classList.add('menulist');

        // 迭代 products 數組
        products.forEach(product => {
            // 創建 li 元素
            if (product.productStatus) {
                const li = document.createElement('li');
                li.dataset.productId = product.productId;

                // 添加商品名稱
                const nameSpan = document.createElement('span');
                nameSpan.textContent = `${product.productName} `;
                li.appendChild(nameSpan);

                // 添加商品價格
                const priceSpan = document.createElement('span');
                priceSpan.textContent = product.productPrice;
                li.appendChild(priceSpan);

                // 綁定點擊事件，點擊 li 後顯示模態框
                li.addEventListener('click', () => {
                    productId = product.productId;
                    fetchProductImage(product.productId);
                    showProductModal(product.productId);
                });

                // 將 li 添加到 ul 中
                ul.appendChild(li);
            }
        });

        // 將 ul 添加到 section 中
        section.appendChild(ul);

        // 將 section 添加到 container 中
        menuContainer.appendChild(section);
    }

    // 顯示模態框並顯示產品信息
    async function showProductModal(productId) {
        try {
            // 獲取產品詳細信息
            const response = await fetch(`/products/${productId}`);

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const product = await response.json();

            const buyNumInput = document.getElementById("buyNum");
            let buyNum = 1; // 默認購買數量為1
            buyNumInput.value = buyNum;

            // 設置單價和總價
            const unitPrice = Number.parseInt(product.productPrice); // 獲取產品單價
            document.getElementById("totalAmt").textContent = unitPrice; // 顯示單價

            // 設置標題、價格和 size
            document.getElementById('productTitle').textContent = product.productName;
            document.querySelector('div.size').textContent = product.size;

            // 模態框的選項設置
            const temperatureOptions = document.getElementById("temperatureOptions");
            const sweetnessOptions = document.getElementById("sweetnessOptions");
            const toppingsOptions = document.getElementById("toppingsOptions");

            // 清空之前的內容
            temperatureOptions.innerHTML = '';
            sweetnessOptions.innerHTML = '';
            toppingsOptions.innerHTML = '';

            // 溫度選項映射
            addOption(temperatureOptions, product.normalIce, "正常冰", "temperature");
            addOption(temperatureOptions, product.lessIce, "少冰", "temperature");
            addOption(temperatureOptions, product.iceFree, "去冰", "temperature");
            addOption(temperatureOptions, product.lightIce, "微冰", "temperature");
            addOption(temperatureOptions, product.roomTemperature, "常溫", "temperature");
            addOption(temperatureOptions, product.hot, "熱", "temperature");

            // 甜度選項映射
            addOption(sweetnessOptions, product.fullSugar, "全糖", "sweetness");
            addOption(sweetnessOptions, product.lessSugar, "少糖", "sweetness");
            addOption(sweetnessOptions, product.halfSugar, "半糖", "sweetness");
            addOption(sweetnessOptions, product.quarterSugar, "微糖", "sweetness");
            addOption(sweetnessOptions, product.noSugar, "無糖", "sweetness");

            // 加料選項映射
            addOption(toppingsOptions, product.pearl, "珍珠", "topping");
            addOption(toppingsOptions, product.pudding, "布丁", "topping");
            addOption(toppingsOptions, product.coconutJelly, "椰果", "topping");
            addOption(toppingsOptions, product.taro, "芋園", "topping");
            addOption(toppingsOptions, product.herbalJelly, "仙草", "topping");

            attachOptionEventHandlers();

            // 更新總價的函數
            const updateTotalPrice = () => {
                const totalPrice = unitPrice * buyNum;
                document.getElementById("totalAmt").textContent = totalPrice;
            };

            // 增加數量
            document.querySelector(".plus").addEventListener("click", function () {
                buyNum = Math.min(buyNum + 1, 999); // 最大值999
                buyNumInput.value = buyNum;
                updateTotalPrice();
            });

            // 減少數量
            document.querySelector(".minus").addEventListener("click", function () {
                buyNum = Math.max(buyNum - 1, 1); // 最小值1
                buyNumInput.value = buyNum;
                updateTotalPrice();
            });

            fetch('/totalusers', {
    method: 'GET', // 請求方法是 GET
})
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json(); // 將返回的結果解析為 JSON 格式
    })
    .then(data => {
        console.log('TotalUserDTO:', data); // 在控制台中顯示 TotalUserDTO

        var userTypeId = data.userTypeId; // 假設 userTypeId 為 0 表示已登入，其他值表示未登入

        // 監聽 "加入購物車" 按鈕的點擊事件
        document.getElementById('addToCartButton').addEventListener('click', function(e) {
            e.preventDefault();
            if (userTypeId !== 0) {
                Swal.fire({
                    title: "請先登入",
                    text: "您必須登入才能將商品加入購物車！",
                    icon: "warning",
                    confirmButtonText: "確定"
                });

                // 隱藏 Lightbox 彈窗
                document.getElementById("lightbox").style.display = "none";


            } else {
                function cart (e) {
                    e.preventDefault();
                    addToCart(productId, buyNum); // 傳入購買數量
                    document.getElementById('addToCartButton').removeEventListener("click",cart);
                    document.getElementById("lightbox").style.display = "none";
                }

                // 添加到購物車
                document.getElementById('addToCartButton').addEventListener('click', cart);
            }
        });
    })
    .catch(error => {
        console.error('Fetch error:', error);
    });


            // function cart (e) {
            //     e.preventDefault();
            //     addToCart(productId, buyNum); // 傳入購買數量
            //     document.getElementById('addToCartButton').removeEventListener("click",cart);
            //     document.getElementById("lightbox").style.display = "none";
            // }
            //
            // // 添加到購物車
            // document.getElementById('addToCartButton').addEventListener('click', cart);

            // 顯示模態框
            document.getElementById("lightbox").style.display = "block";
        } catch (error) {
            console.error('Error fetching product data:', error);
        }
    }



    // 添加選項的輔助函數
    function addOption(container, condition, text, type) {
        if (condition) {
            const div = document.createElement("div");
            div.classList.add(type);  // 使用不同的類名來區分選項類型
            div.textContent = text;
            container.appendChild(div);
        }
    }

    // 將商品加入購物車的函數
    // function addToCart(productId, buyNum) {
    //     // 從 localStorage 獲取現有的購物車數據
    //     let cart = JSON.parse(localStorage.getItem('cart')) || {};
    //
    //     // 確保該商品ID有對應的數據
    //     if (!cart[productId]) {
    //         cart[productId] = {};
    //     }
    //
    //
    //     // 獲取當前的選擇（從 localStorage 讀取尺寸、溫度、甜度等）
    //     const selectedSize = localStorage.getItem('selectedSize');
    //     const selectedTemperature = localStorage.getItem('selectedTemperature');
    //     const selectedSweetness = localStorage.getItem('selectedSweetness');
    //     const selectedToppings = localStorage.getItem('selectedToppings');
    //
    //     // 更新該商品ID的數據，並加上購買數量
    //     // 如果選項未選，顯示警告並退出函數
    //     if (!selectedSize || selectedSize === "null" || selectedSize === "") {
    //         Swal.fire({
    //             text: "請選擇尺寸！",
    //             icon: "warning"
    //         });
    //         return;
    //     }
    //
    //     if (!selectedTemperature || selectedTemperature === "null" || selectedTemperature === "") {
    //         Swal.fire({
    //             text: "請選擇溫度！",
    //             icon: "warning"
    //         });
    //         return;
    //     }
    //
    //     if (!selectedSweetness || selectedSweetness === "null" || selectedSweetness === "") {
    //         Swal.fire({
    //             text: "請選擇甜度！",
    //             icon: "warning"
    //         });
    //         return;
    //     }
    //
    //
    //     // 更新該商品ID的數據，並加上購買數量
    //     cart[productId] = {
    //         size: selectedSize,
    //         temperature: selectedTemperature,
    //         sweetness: selectedSweetness,
    //         toppings: selectedToppings || "",  // 加料可選
    //         buyNum: buyNum  // 保存購買數量
    //     };
    //
    //
    //     // 保存更新的購物車數據到 localStorage
    //     localStorage.setItem('cart', JSON.stringify(cart));
    //
    //     // 顯示提示訊息，確認商品已添加到購物車
    //     Swal.fire({
    //         text: "商品加入購物車成功!",
    //         icon: "success"
    //     });
    //
    //
    // }


// function addToCart(productId, buyNum) {
//     // 初始化選擇的值
//     let selectedSize = null;
//     let selectedTemperature = null;
//     let selectedSweetness = null;
//     let selectedToppings = null;
//
//     // 只有在 localStorage 有值時才讀取並賦值
//     if (localStorage.getItem('selectedSize')) {
//         selectedSize = localStorage.getItem('selectedSize');
//     }
//     if (localStorage.getItem('selectedTemperature')) {
//         selectedTemperature = localStorage.getItem('selectedTemperature');
//     }
//     if (localStorage.getItem('selectedSweetness')) {
//         selectedSweetness = localStorage.getItem('selectedSweetness');
//     }
//     if (localStorage.getItem('selectedToppings')) {
//         selectedToppings = localStorage.getItem('selectedToppings');
//     }
//
//     // 確認是否選擇了尺寸、溫度和甜度，沒有則提示用戶
//     if (!selectedSize) {
//         Swal.fire({
//             text: "尺寸未選！",
//             icon: "warning"
//         });
//         return;
//     }
//     if (!selectedTemperature) {
//         Swal.fire({
//             text: "溫度未選！",
//             icon: "warning"
//         });
//         return;
//     }
//     if (!selectedSweetness) {
//         Swal.fire({
//             text: "甜度未選！",
//             icon: "warning"
//         });
//         return;
//     }
//
//     // 獲取購物車資料並更新
//     let cart = JSON.parse(localStorage.getItem('cart')) || {};
//     cart[productId] = {
//         size: selectedSize,
//         temperature: selectedTemperature,
//         sweetness: selectedSweetness,
//         toppings: selectedToppings || "未選擇加料",
//         buyNum: buyNum
//     };
//
//     // 更新購物車到 localStorage
//     localStorage.setItem('cart', JSON.stringify(cart));
//
//     // 顯示成功提示
//     Swal.fire({
//         text: "商品加入購物車成功!",
//         icon: "success"
//     });
// }


// function addToCart(productId, buyNum) {
//     // 初始化選擇的值
//     let selectedSize = null;
//     let selectedTemperature = null;
//     let selectedSweetness = null;
//     let selectedToppings = null;
//
//     // 只有在 localStorage 有值時才讀取並賦值
//     const storedSize = localStorage.getItem('selectedSize');
//     const storedTemperature = localStorage.getItem('selectedTemperature');
//     const storedSweetness = localStorage.getItem('selectedSweetness');
//     const storedToppings = localStorage.getItem('selectedToppings');
//
//     // 確保只在用戶實際選擇了時才賦值
//     if (storedSize) {
//         selectedSize = storedSize;
//     }
//     if (storedTemperature) {
//         selectedTemperature = storedTemperature;
//     }
//     if (storedSweetness) {
//         selectedSweetness = storedSweetness;
//     }
//     if (storedToppings) {
//         selectedToppings = storedToppings;
//     }
//
//     // 確認是否選擇了尺寸、溫度和甜度，沒有則提示用戶
//     if (!selectedSize) {
//         Swal.fire({
//             text: "尺寸未選！",
//             icon: "warning"
//         });
//         return; // 終止函數執行
//     }
//     if (!selectedTemperature) {
//         Swal.fire({
//             text: "溫度未選！",
//             icon: "warning"
//         });
//         return; // 終止函數執行
//     }
//     if (!selectedSweetness) {
//         Swal.fire({
//             text: "甜度未選！",
//             icon: "warning"
//         });
//         return; // 終止函數執行
//     }
//
//     // 獲取購物車資料並更新
//     let cart = JSON.parse(localStorage.getItem('cart')) || {};
//     cart[productId] = {
//         size: selectedSize,
//         temperature: selectedTemperature,
//         sweetness: selectedSweetness,
//         toppings: selectedToppings || "未選擇加料", // 如果未選擇加料，使用預設值
//         buyNum: buyNum
//     };
//
//     // 更新購物車到 localStorage
//     localStorage.setItem('cart', JSON.stringify(cart));
//
//     // 顯示成功提示
//     Swal.fire({
//         text: "商品加入購物車成功!",
//         icon: "success"
//     });
// }

function getSelectedItem(key) {
    const value = localStorage.getItem(key);
    return value ? value : null; // 如果有值则返回，否则返回 null
}

// 使用封装的函数获取选项
const storedSize = getSelectedItem('selectedSize');
const storedTemperature = getSelectedItem('selectedTemperature');
const storedSweetness = getSelectedItem('selectedSweetness');
const storedToppings = getSelectedItem('selectedToppings');

function addToCart(productId, buyNum) {
    // 从 localStorage 获取现有的购物车数据
    let cart = JSON.parse(localStorage.getItem('cart')) || {};

    // 确保该商品ID有对应的数据
    if (!cart[productId]) {
        cart[productId] = {};
    }

    // 获取当前的选择（尺寸、温度、甜度、加料）

    // 检查用户是否选择了所有必需选项
    if (!storedSize || !storedTemperature || !storedSweetness) {
        Swal.fire({
            text: "请確保所有選項都有選擇！",
            icon: "warning"
        });
        return; // 终止函数执行
    }

    // 清除上一次的选项数据
    localStorage.removeItem('selectedSize');
    localStorage.removeItem('selectedTemperature');
    localStorage.removeItem('selectedSweetness');
    localStorage.removeItem('selectedToppings');

    // 更新该商品ID的数据，并加上购买数量
    cart[productId] = {
        size: storedSize,
        temperature: storedTemperature,
        sweetness: storedSweetness,
        toppings: storedToppings || "未选择加料",
        buyNum: buyNum // 保存购买数量
    };

    // 保存更新的购物车数据到 localStorage
    localStorage.setItem('cart', JSON.stringify(cart));

    // 显示提示信息，确认商品已添加到购物车
    Swal.fire({
        text: "商品加入購物車成功!",
        icon: "success"
    });
}









    // 為選項添加事件處理器
    attachOptionEventHandlers(productId);

    // 設置選項事件處理的函數，與之前的一致
    function attachOptionEventHandlers(productId) {
        const sizeOption = document.querySelector('.size');

        sizeOption.addEventListener('click', function() {
            localStorage.setItem('selectedSize', sizeOption.textContent);
            sizeOption.style.backgroundColor = '#fac792'; // 改變背景顏色
        });

        document.querySelectorAll('#temperatureOptions .temperature').forEach(option => {
            option.addEventListener('click', () => {
                updateTemperatureColors(option);
                localStorage.setItem('selectedTemperature', option.textContent);
            });
        });

        document.querySelectorAll('#sweetnessOptions .sweetness').forEach(option => {
            option.addEventListener('click', () => {
                updateSweetnessColors(option);
                localStorage.setItem('selectedSweetness', option.textContent);
            });
        });

        document.querySelectorAll('#toppingsOptions .topping').forEach(option => {
            option.addEventListener('click', () => {
                updateToppingsColors(option);
                localStorage.setItem('selectedToppings', option.textContent);
            });
        });
    }

    // 改變選項顏色的函數 (與之前相同)
    function updateTemperatureColors(selectedOption) {
        document.querySelectorAll('#temperatureOptions .temperature').forEach(option => {
            if (option === selectedOption) {
                option.style.backgroundColor = '#fac792';
            } else {
                option.style.backgroundColor = '';
            }
        });
    }

    function updateSweetnessColors(selectedOption) {
        document.querySelectorAll('#sweetnessOptions .sweetness').forEach(option => {
            if (option === selectedOption) {
                option.style.backgroundColor = '#fac792';
            } else {
                option.style.backgroundColor = '';
            }
        });
    }
function fetchProductImage(productId) {
    // Construct the URL for the image based on the product ID
    const imgElement = document.getElementById('productImage');
    imgElement.src ='';
    const url = `/products/${productId}/image`; // Adjust the URL according to your API endpoint

    // Use fetch to get the image
    fetch(url)
        .then(response => {
            if (response.ok) {
                return response.text(); // 將回應解析為文本，也就是Base64字符串
            } else {
                throw new Error('Image not found');
            }
        })
        .then(base64Image => {
            // 將Base64圖片插入到img標籤中
            imgElement.src = `data:image/png;base64,${base64Image}`;
        })
        .catch(error => {
            console.error('Error fetching the image:', error);
        });

}

    function updateToppingsColors(selectedOption) {
        document.querySelectorAll('#toppingsOptions .topping').forEach(option => {
            if (option === selectedOption) {
                option.style.backgroundColor = '#fac792';
            } else {
                option.style.backgroundColor = '';
            }
        });
    }


    // 關閉模態框
    document.querySelector('.close').onclick = function () {
        document.getElementById("lightbox").style.display = "none";
    };


</script>

</body>


</html>



