<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>faq</title>

    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png"/>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <link rel="stylesheet" href="assets/css/jquery-ui.css">
    <link rel="stylesheet" href="assets/css/slick.css">
    <link rel="stylesheet" href="assets/css/chosen.min.css">
    <link rel="stylesheet" href="assets/css/pe-icon-7-stroke.css">
    <link rel="stylesheet" href="assets/css/magnific-popup.min.css">
    <link rel="stylesheet" href="assets/css/lightbox.min.css">
    <link rel="stylesheet" href="assets/js/fancybox/source/jquery.fancybox.css">
    <link rel="stylesheet" href="assets/css/jquery.scrollbar.min.css">
    <link rel="stylesheet" href="assets/css/mobile-menu.css">
    <link rel="stylesheet" href="assets/fonts/flaticon/flaticon.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/faq.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/weien-chat.css">
</head>

<body>
<div class="header"></div>
<div class="main-content main-content-contact">
    <div class="page-main-content">
        <div id="faq">
            <div class="row">
                <div class="col-lg-12">
                    <div class="form-contact reset-margin row">

                        <div class="col-lg-3" id="faq-nav">
                            <div id="faq-query-bar">
                                <input id="faq-input" type="text" placeholder="搜尋問題關鍵字">
                                <a href="#" id="search">
                                    <i class="fa fa-search" aria-hidden="true"></i>
                                </a>
                            </div>
                            <div id="title-list">
                                <ul >
                                    <li>
                                        <a href="#faq-card-1">新手上路</a>
                                    </li>
                                    <li>
                                        <a href="#faq-card-2">會員資訊</a>
                                    </li>
                                    <li>
                                        <a href="#faq-card-3">訂購資訊</a>
                                    </li>
                                    <li>
                                        <a href="#faq-card-4">優惠券與集點卡</a>
                                    </li>
                                    <li>
                                        <a href="#faq-card-5">其他問題</a>
                                    </li>
                                </ul>
                            </div>

                        </div>
                        <div class="col-lg-9" id="card-list">
                            <div class="faq-card" id = faq-card-1>
                                <div class="card-title">
                                    新手上路
                                </div>
                                <ul class="faq-list">
                                    <li>
                                        <a class="link_title" href="#">
                                            <button type="button" class="switch_btn">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 訂餐流程 ] 如何使用夏虎茶訂餐？</span>
                                        </a>

                                        <div class="inner_block">
                                            <span>在首頁點擊店家即可查看該店家的菜單並進行訂單</span>
                                        </div>

                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button type="button" class="switch_btn">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 取餐資訊 ] 門市的營業時間/電話/地址/外送限制/取餐方式/支付方式/金額上限</span>
                                        </a>
                                        <div class="inner_block">
                                            請查看菜單上的店家資訊顯示該店家詳細營運資料
                                        </div>
                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button type="button" class="switch_btn">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 優惠券 ] 如何使用優惠券享有折扣？</span>
                                        </a>
                                        <div class="inner_block">
                                            結帳頁面可於優惠使用功能-優惠券，根據使用者擁有優惠券進行選用折抵。
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="faq-card" id = faq-card-2>
                                <div class="card-title">
                                    會員資訊
                                </div>
                                <ul class="faq-list">
                                    <li>
                                        <a class="link_title" href="#">
                                            <button type="button" class="switch_btn">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 會員驗證 ] 收不到手機認證碼</span>
                                        </a>

                                        <div class="inner_block">
                                            <div>
                                                可能會導致收不到簡訊驗證碼的情況有以下幾種，建議您嘗試以下方法：<br>
                                                1. 請您再次確認於手機號碼欄位所選擇的國碼及輸入的手機號碼是否正確。<br>
                                                2. 訊號不佳或者網路壅塞皆會導致無法收取驗證碼，建議可至訊號通順良好的地方再次獲取驗證碼，或者稍後重新獲取即可。<br>
                                                3.請確認是否有設定來電攔截APP (e.g. Whoscall)，如果有設定到黑名單，由於驗證簡訊通常為系統大量發送訊息，很可能被手機判為廣告，請解除攔截或封鎖，避免簡訊接收失敗。<br>
                                                4. 若您使用iOS手機，訊息裡的設定請不要使用 3rd party 程式來封鎖/過濾黑名單聯絡人，避免簡訊接收失敗。<br>
                                                5. 部分電信業者有提供的＂拒收企業簡訊＂功能，該功能可能導致無法正常接受驗證碼簡訊。解除流程可能因業者系統升級而有所不同，請見電信業者官網為主，若需查詢、關閉此功能請自行洽詢所屬電信商。<br>
                                                <br>
                                            　   以中華電信為例，消費者有2個確認方式：<br>

                                                1. 登入emome網站後，點選「我的emome」－「熱門服務」中，點選「拒絕企業簡訊」，確認此服務是否為「未申請」狀態，若申請可能導致簡訊停用而無法正常接收簡訊。<br>
                                                （※關閉此服務後，約需4小時作業時間後才可重新接收企業簡訊。若不熟悉網站操作步驟，可致電各電信業者客服，透過電話語音操作完成服務變更。）<br>
                                                2. 以市話或手機撥打電信業者客服電話，經過身份驗證後，向客服人員詢問是否有申請「拒收企業簡訊」服務。
                                            </div>
                                            <img src="./faqImg/2024-10-03%20205325.png">
                                            <div>
                                                除了上述情況外，若仍無法收受簡訊驗證碼，您可依以下方式進行手機操作排除以下狀況：<br>
                                                1. 確認手機儲存空間，若儲存空間已滿將無法收受簡訊驗證碼。<br>
                                                2. 將手機重新啟用。
                                                3.若上述仍無法排除，請您加入官方客服，由客服人員協助驗證作業。</div>
                                        </div>
                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button type="button" class="switch_btn">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 忘記密碼 ] 忘記密碼無法登入怎麼辦?</span>
                                        </a>

                                        <div class="inner_block">
                                            <div>登入頁面點選忘記密碼</div>
                                            <img src="./faqImg/2024-10-03%20204029.png">
                                            <div>輸入手機號碼後按下重設密碼</div>
                                            <img src="./faqImg/2024-10-03%20204337.png">
                                            <div>系統會發送驗證碼到手機</div>
                                            <img src="./faqImg/2024-10-03%20204457.png">
                                            <div>輸入密碼&簡訊驗證碼後點選重設密碼</div>
                                            <img src="./faqImg/2024-10-03%20204550.png">
                                            <div>驗證&重設成功會跳出視窗並導到登入畫面</div>
                                            <img src="./faqImg/2024-10-03%20204635.png">
                                        </div>

                                    </li>

                                </ul>

                            </div>
                            <div class="faq-card" id = faq-card-3>
                                <div class="card-title">
                                    訂購資訊
                                </div>
                                <ul class="faq-list">
                                    <li>
                                        <a class="link_title" href="#">
                                            <button type="button" class="switch_btn">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 取餐方式 ] 門市是否支援外送服務？</span>
                                        </a>

                                        <div class="inner_block">
                                            外送服務請查看菜單上的店家資訊，有說明是否提供外送
                                        </div>

                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button type="button" class="switch_btn">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 訂購資訊 ] 收到的商品品項有誤</span>
                                        </a>
                                        <div class="inner_block">
                                            如有任何商品內容的錯誤，可於訂單明細內，提出申請爭議；夏虎茶確認爭議內容後，會再以實際情況與您協議補償或退款。
                                            vero.
                                        </div>
                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button type="button" class="switch_btn">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 訂購資訊 ] 登入找不到訂單</span>
                                        </a>
                                        <div class="inner_block">
                                            請確認下訂時與現在是否為相同帳號 (相同入徑登入)。
                                        </div>
                                    </li>
                                    <li>
                                        <a class="link_title" href="#">
                                            <button type="button" class="switch_btn">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 付款資訊 ] 申請退款後，多久會收到退款呢？</span>
                                        </a>

                                        <div class="inner_block">
                                            <span>申請退款後，由夏虎茶向店家確認實際狀況後，進行退款至會員錢包，故訂單列表之爭議狀態顯示「同意爭議」時，系統將同步將款項退至會員錢包，可至會員中心進行確認退款款項。</span>
                                        </div>

                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button type="button" class="switch_btn">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 發票開立 ] 有打統編的公司發票存入個人載具，該怎麼查詢/列印？</span>
                                        </a>
                                        <div class="inner_block">
                                            1. 須請公司會計單位使用“公司帳號“登入，選擇「營業人」進入「財政部電子發票整合服務平台」查詢/列印。<br>
                                            2. 使用“個人帳號“登入財政部電子發票整合服務平台的話，僅能看到簡易明細，無法下載正式的電子發票證明。<br>
                                            3. <a href="https://www.mof.gov.tw/singlehtml/155?cntId=84135"
                                                  target="_blank">財政部電子發票整合服務平台官方資訊參考</a>
                                        </div>
                                    </li>
                                </ul>

                            </div>
                            <div class="faq-card" id = faq-card-4>
                                <div class="card-title">
                                    優惠券與集點卡
                                </div>
                                <ul class="faq-list">
                                    <li>
                                        <a class="link_title" href="#">
                                            <button class="switch_btn" type="button">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 優惠券 ] 如何取得優惠券？</span>
                                        </a>

                                        <div class="inner_block">
                                            <span>優惠券會由平台方發放 可在首頁點擊優惠券查看擁有那些優惠券</span>
                                        </div>

                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button class="switch_btn" type="button">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 優惠券 ] 我該如何知道優惠券規則？</span>
                                        </a>
                                        <div class="inner_block">
                                            <span>點擊所要了解的優惠券，即可顯示使用說明</span>
                                        </div>
                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button class="switch_btn" type="button">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 優惠券 ] 如何使用優惠券?</span>
                                        </a>
                                        <div class="inner_block">
                                            結帳頁面可於優惠使用功能-優惠券，根據使用者擁有優惠券進行選用折抵。
                                        </div>
                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button class="switch_btn" type="button">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 優惠券 ] 如何知道我的券夾裡有什麼優惠券以及優惠券使用期限呢？</span>
                                        </a>
                                        <div class="inner_block">
                                            可在右上角會員中心點選優惠券，查看擁有的優惠券
                                        </div>
                                    </li>
                                    <li>
                                        <a class="link_title" href="#">
                                            <button class="switch_btn" type="button">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 集點卡 ] 如何獲得店家集點卡？</span>
                                        </a>

                                        <div class="inner_block">
                                            需要店家有啟動集點卡功能，並且消費滿足店家要求額度即可累積一點
                                        </div>

                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button class="switch_btn" type="button">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 集點卡 ] 如何進行點數兌換?</span>
                                        </a>
                                        <div class="inner_block">
                                            結帳頁面可於使用功能-會員卡，根據使用者於該店面會員點數進行累點折抵。
                                        </div>
                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button class="switch_btn" type="button">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 集點卡 ] 如何知道我的有哪些集點卡與集點卡使用期限</span>
                                        </a>
                                        <div class="inner_block">
                                            <span>
                                                在首頁點擊會員卡即可查看各集點卡資訊
                                            </span>
                                        </div>
                                    </li>
                                </ul>

                            </div>
                            <div class="faq-card" id = faq-card-5>
                                <div class="card-title">
                                    其他問題
                                </div>
                                <ul class="faq-list">
                                    <li>
                                        <a class="link_title" href="#">
                                            <button class="switch_btn" type="button">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 系統異常 ] 點擊按鈕無反應</span>
                                        </a>

                                        <div class="inner_block">
                                            1. 請確認是否使用 Chrome, Safari, Firefox 瀏覽器，以及是否為正常狀態
                                            (非私密瀏覽、非無痕視窗)<br>
                                            2. 請確認網路訊號狀態，是否有設定任何阻擋<br>
                                            3. 請確認是否有關閉cookie存取的設定<br>
                                            4. 可嘗試重新整理頁面<br>
                                            5. 請向夏虎茶客服反應<br>
                                        </div>

                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button class="switch_btn" type="button">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 定位問題 ] 怎麼開啟定位呢？</span>
                                        </a>
                                        <div class="inner_block">
                                            <span>在電腦上開啟Chrome,依序選取右上方的「更多」圖示 「設定」 「隱私權和安全性」,選取「網站設定」,在「權限」下方選取「位置」,選擇要設為預設設定的選項</span>
                                        </div>
                                    </li>

                                    <li>
                                        <a class="link_title" href="#">
                                            <button class="switch_btn" type="button">
                                                <span class="-plus">+</span>
                                                <span class="-minus">-</span>
                                            </button>
                                            <span>[ 門市募集 ] 我是店家，想加入(了解)夏虎茶</span>
                                        </a>
                                        <div class="inner_block">
                                            <div>
                                                想要加入夏虎茶，使用夏虎茶全方位服務嗎？<br>
                                                請於官方網站留下您的資料我們將儘速與您聯繫！<br>
                                                <br>
                                                <a href="joinUs.html">夏虎茶官方網站</a>
                                            </div>
                                        </div>
                                    </li>
                                </ul>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="chat-room">

        <div class="chat-container">
            <div id="weien-chat"></div>
        </div>
        <div id="chat-icon" class="">
            <b class="bi bi-chat-dots"></b>
        </div>

    </div>
</div>
<div class="footer"></div>


<script src="assets/js/jquery-1.12.4.min.js"></script>
<script src="assets/js/jquery.plugin-countdown.min.js"></script>
<script src="assets/js/jquery-countdown.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/owl.carousel.min.js"></script>
<script src="assets/js/magnific-popup.min.js"></script>
<script src="assets/js/isotope.min.js"></script>
<script src="assets/js/jquery.scrollbar.min.js"></script>
<script src="assets/js/jquery-ui.min.js"></script>
<script src="assets/js/mobile-menu.js"></script>
<script src="assets/js/chosen.min.js"></script>
<script src="assets/js/slick.js"></script>
<script src="assets/js/jquery.elevateZoom.min.js"></script>
<script src="assets/js/jquery.actual.min.js"></script>
<script src="assets/js/fancybox/source/jquery.fancybox.js"></script>
<script src="assets/js/lightbox.min.js"></script>
<script src="assets/js/owl.thumbs.min.js"></script>
<script src="assets/js/jquery.scrollbar.min.js"></script>
<script src="assets/js/frontend-plugin.js"></script>
<script src="./cms/plugins/sweetalert2/sweetalert2.all.js"></script>
<script src="js/general.js"></script>
<script src="js/faq.js"></script>
<script src="js/weien-chat-box.js"></script>

<script type="module">
    import { actionHandlers, WeienChat } from './js/weien-chat-box.js'
    let userTypeId;
    let totalUserId;
    const url
        =  `ws://${location.host}${location.pathname.substring(0, location.pathname.lastIndexOf('/') + 1)}cms/chat`;

    // 使用前須覆寫actionHandlers中必要的方法
    // 詳細可以去 weien-chat.js 中的 actionHandlers查看
    actionHandlers.getChatRoomsData = async () => {
        return await fetch("/chatroomdata")
            .then(res => res.json())
            .then(data =>{
                return data;
            })
    }

    actionHandlers.getChatMessagesData = async (chatId) => {

        return await fetch(`/chatmessagesdata/${chatId}`)
            .then(res => res.json())
            .then(ChatMessagesData =>{
                return ChatMessagesData;
            })
    }

    actionHandlers.loadMoreChatRooms = async (type) => {
        // console.log(type);
        // type是指現在的過濾模式 (全部, 未讀, 置頂)
        // 目前是傳入假資料
        return chatRoomData;
    }

    actionHandlers.loadMoreMessages = async () => {
        // 目前是傳入假資料
        return messages;
    }

    actionHandlers.getUID = async () => {
        return await fetch("/totalusers")
            .then(res => res.json())
            .then(data => {
                userTypeId = data.userTypeId;
                if(userTypeId === 0){
                    totalUserId = data.totalUserId;
                    return totalUserId;
                }
                console.log("錯誤 : " + error)
                let chatRoom = $("div.chat-room").eq(0);
                $(chatRoom).css("visibility","hidden");
                $(chatRoom).addClass("d-none")
                console.log($("div.chat-room").eq(0))
            }).catch(error=>{
                console.log("錯誤 : " + error)
                let chatRoom = $("div.chat-room").eq(0);
                $(chatRoom).css("visibility","hidden");
                $(chatRoom).addClass("d-none")
                console.log($("div.chat-room").eq(0))
            })
    }

    actionHandlers.sendMessage = (message) => {
        message.timestamp = new Date();
        chat.updateChatListInfo(message.chatId,message);
        chat.appendMessage(message);
        if (webSocket) {
            webSocket.send(
                JSON.stringify({
                    chatSessionId: message.chatId,
                    content: message.content,
                    senderId : message.senderId,
                    timestamp : message.timestamp
                })
            )
        }
    }

    actionHandlers.updateFile = async (selectedFile) =>{
        let reader = new FileReader(); // 用來讀取檔案的物件
        reader.readAsDataURL(selectedFile); // 讀取檔案
        let imgMessage;
        reader.addEventListener("load", function () {
            // 1. 圖片訊息加入user聊天室
            let timestamp = new Date();
            imgMessage = {
                chatId: chat.getActiveChatId(),
                senderId: totalUserId,
                content: selectedFile.name,
                timestamp : timestamp,
                img:{
                    src:reader.result
                }
            }
            chat.updateChatListInfo(imgMessage.chatId,imgMessage);
            chat.appendMessage(imgMessage);

            // 2. 將圖片訊息存入 DB
            fetch("/chatmessagesdata/imgmessage",{
                method:"POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    chatSessionId: imgMessage.chatId,
                    content: imgMessage.content,
                    senderId : imgMessage.senderId,
                    timestamp : imgMessage.timestamp,
                    img: {
                        src:imgMessage.img.src
                    }
                })
            }).then(res => res.json())
                // 3. 存入後，再利用 Websocket 讓對方去資料庫取資料
                .then(messageDto => {
                    if(webSocket){
                        webSocket.send(
                            JSON.stringify({
                                messageId:messageDto.messageId,
                                chatSessionId: messageDto.chatSessionId,
                                content: messageDto.content,
                                senderId : messageDto.senderId,
                                timestamp : messageDto.timestamp,
                            })
                        );
                    }
                }).catch(error => {
                console.error("Error sending message:", error);
            })
        });
    }

    const handleSendMessage = async  e =>  {
        let payload = JSON.parse(e.data);
        let message = {
            chatId : payload.chatSessionId,
            content : payload.content,
            senderId : payload.senderId,
            timestamp : payload.timestamp,
            img:payload.img
        }
        if (payload.messageId != null) {
            const messageDTO = await fetch(`/chatmessagesdata/message/${payload.messageId}`)
                .then(res => res.json());
            message.img = messageDTO.img;
        }

        let activeChatId = chat.getActiveChatId();      //獲取這個聊天室的id
        chat.updateChatListInfo(message.chatId,message);  //更新聊天室側邊欄聊天室列表
        if(activeChatId === message.chatId){
            chat.appendMessage(message);
        }

    }


    const chat = new WeienChat();

    let webSocket;

    $("#chat-icon").on("click",async() => {
        $(".chat-container").toggle();
    })

    document.addEventListener('DOMContentLoaded', async () => {
        // 加載完成以後啟動
        await chat.init();
        chat.state.value.showMode = 'mobile'
        await function (){
            if(userTypeId === 0){
                $(".weien-chating-name").eq(0).text("管理員");
            }
        }
        let chatRoomsData = await actionHandlers.getChatRoomsData();        //獲取聊天室資料
        let chatSessionId = await chatRoomsData[0].chatId;                  //第一筆聊天室的 chatId
        chat.state.value.activeChatId = chatSessionId;
        webSocket = new WebSocket(url);
        webSocket.addEventListener('open', console.log("WebSocket connection established"));
        webSocket.addEventListener('message', handleSendMessage);
        webSocket.addEventListener('error',(event) => {
            console.log("Message received:", event.data)})
    });

</script>
</body>


</html>