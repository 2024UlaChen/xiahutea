<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>夏虎茶</title>
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png"/>
    <link
            href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i&display=swap"
            rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <link rel="stylesheet" href="assets/css/jquery-ui.css">
    <link rel="stylesheet" href="assets/css/slick.css">
    <link rel="stylesheet" href="assets/css/chosen.min.css">
    <link rel="stylesheet" href="assets/css/pe-icon-7-stroke.css">
    <link rel="stylesheet" href="assets/css/magnific-popup.min.css">
    <link rel="stylesheet" href="assets/css/lightbox.min.css">
    <link rel="stylesheet" href="assets/js/fancybox/source/jquery.fancybox.css">
    <link rel="stylesheet" href="assets/css/jquery.scrollbar.min.css">
    <link rel="stylesheet" href="assets/css/mobile-menu.css">
    <link rel="stylesheet" href="assets/fonts/flaticon/flaticon.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/member.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <link
    href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i&display=swap"
    rel="stylesheet"
  />
  <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
  <link
    href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i&display=swap"
    rel="stylesheet"
  />
   

    <!--    <link rel="stylesheet" href="./slicktools/slick-theme.css">-->
        <link rel="stylesheet" href="./css/homePage.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
   
  </head>
  <body>

    <header class="header style2">
      <div class="top-bar">
        <div class="container">
          <div class="row">
            
              <div class="col-lg-3">
                <div class="header-message">
                  <h1>
                      <a href="homePage.html" id="searchHome">夏虎茶</a>
                  </h1>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="query-bar">
                  <a href="#" id="forSearchStore">
                      <span>
                      <i class="fa fa-search" aria-hidden="true"></i>
                    </span>
                  </a>
                  <input type="text" placeholder="搜尋品牌、門市或商品" name="" id="user-enter-keyword">
                  <a href="#" >
                    <span>
                      <i class="fa fa-times" aria-hidden="true" id="clearSearch"></i>
                    </span>
                  </a>
                </div>
              </div>
              <div class="col-lg-3">
                <ul class="header-user-links top-bar-right">
                  <li>
                    <a href="orderList.html">
                      <span>
                        <i class="fa fa-book" aria-hidden="true"></i>
                      </span>
                    </a>
                  </li>
                  <li>
                    <a href="cartDetail.html">
                      <span>
                        <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                      </span>
                    </a>
                  </li>

                  <li class="teamo-dropdown block-account">
                    <a href="#" data-teamo="teamo-dropdown">
                      <span>
                        <i class="fa fa-user-circle" aria-hidden="true"></i>
                      </span>
                    </a>
                    <ul class="teamo-submenu" id="query-member">
                      <li class="switcher-option">
                        <div class="account-list row">
                          <div class="col-lg-12 no-padding">
                            <div class="col-sm-4">
                              <img src="" alt="" class="userPhoto" id="userLogo">
                            </div>
                            <div class="col-lg-8">
                              <span id="userName">userName</span>
                            </div>
                          </div>
                        </div>
                      </li>
                      <li class="switcher-option">
                        <a href="member.html">
                          <span> 帳號設定 </span>
                        </a>
                      </li>
                      <li class="switcher-option">
                        <a href="loyaltyCard.html">
                          <span> 會員卡 </span>
                        </a>
                      </li>
                      <li class="switcher-option">
                        <a href="coupon.html">
                          <span> 優惠券 </span>
                        </a>
                      </li>
                      <hr>
                      <li class="switcher-option">
                        <a href="orderList.html">
                          <span> 訂單管理 </span>
                        </a>
                      </li>
                      <li class="switcher-option">
                        <a href="faq.html">
                          <span> 常見問題 </span>
                        </a>
                      </li>
                      <hr>
                      <li class="switcher-option">
                        <a href="#" id="logOut">
                          <span> 登出 </span>
                        </a>
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            
          </div>
        </div>
      </div>
    </header>
    
    <div class="kunClass" id="homeDisplayAds">

    </div>
    <!--輪播結束-->

    <div class="Container m-5" style="text-align: center"></div>
    <div class="Container m-5">
      <div class="row KunSpeedSearch">
          <div class="col-5"></div>

        <div class="col text-center" id="localLog-Modal" data-bs-toggle="modal" data-bs-target="#localModal">
          <i class="fa-solid fa-map-location"><a href="#">找附近</a></i>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="localModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="localModalLabel">找附近</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <input type="text" id="user-place" placeholder="輸入地址">

              </div>
              <div class="modal-footer">

                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="autoCatchUserPlace">定位</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Button trigger modal -->
        <div class="col text-center" id="myModal" data-bs-toggle="modal" data-bs-target="#exampleModal">
          <i class="fa-solid fa-map"><a href="#">找區域</a></i>
        </div>

        <!-- Modal -->
          <div
                  class="modal fade"
                  id="exampleModal"
                  tabindex="-1"
                  aria-labelledby="exampleModalLabel"
                  aria-hidden="true"
          >
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel">找區域</h5>
                          <button
                                  type="button"
                                  class="btn-close"
                                  data-bs-dismiss="modal"
                                  aria-label="Close"
                          ></button>
                      </div>
                      <div class="modal-body">
                          <select
                                  class="form-select"
                                  id="PlaceSearch"
                                  aria-label="Default select example"
                          >
                              <option selected>選擇縣市</option>
                              <option value="新北市">新北市</option>
                              <option value="台北市">台北市</option>
                              <option value="基隆市">基隆市</option>
                              <option value="桃園市">桃園市</option>
                              <option value="台中市">台中市</option>
                              <option value="台南市">台南市</option>
                              <option value="高雄市">高雄市</option>
                              <option value="新竹市">新竹市</option>
                              <option value="新竹縣">新竹縣</option>
                              <option value="苗栗縣">苗栗縣</option>
                              <option value="彰化縣">彰化縣</option>
                              <option value="南投縣">南投縣</option>
                              <option value="雲林縣">雲林縣</option>
                              <option value="嘉義市">嘉義市</option>
                              <option value="嘉義縣">嘉義縣</option>
                              <option value="屏東縣">屏東縣</option>
                              <option value="台東縣">台東縣</option>
                              <option value="花蓮縣">花蓮縣</option>
                              <option value="宜蘭縣">宜蘭縣</option>
                              <option value="澎湖縣">澎湖縣</option>
                              <option value="金門縣">金門縣</option>
                              <option value="連江縣">連江縣</option>

                          </select
                          ><br />

                          <select
                                  class="form-select"
                                  id="AreaSearch"
                                  aria-label="Default select example"
                          >
                              <option selected>選擇區域</option>
                          </select>
                      </div>
                      <div class="modal-footer">
                          <button
                                  type="button"
                                  class="btn btn-secondary"
                                  data-bs-dismiss="modal"
                          >
                              關閉
                          </button>
                          <button type="button" class="btn btn-primary" id="twoPlaceSearch" data-bs-dismiss="modal" >確認</button>
                      </div>
                  </div>
              </div>
          </div>
        <div class="col-5"></div>



      </div>
      <!-- 商家卡片呈現 -->

      <div class="row justify-content-center" id="store-body">



      </div>

      <div class="row align-items-md-stretch">
        <div class="col-md-6">
          <div class="h-100 p-5 text-white bg-dark rounded-3">
            <h2 style="color: aliceblue">有夏虎茶真好，快來瞭解我們吧</h2>

            <a href="faq.html" class="btn btn-outline-light" type="button">
              快速上手
            </a>
          </div>
        </div>
        <div class="col-md-6">
          <div class="h-100 p-5 bg-light border rounded-3">
            <h2>有夏虎茶真好，快來加入我們吧</h2>

            <a href="joinUs.html" class="btn btn-outline-secondary" type="button">
              手刀報名
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- 頁腳 -->
    <footer class="footer style7">
      <div class="container">
          <div class="container-wapper no-padding">
              <div class="row">
                  <div class="box-footer col-xs-12 col-sm-4 col-md-4 col-lg-4">
                      <div class="teamo-custommenu default">
                          <ul class="menu">
                              <li class="menu-item">
                                  <h3>夏虎茶</h3>
                              </li>
                              <li class="menu-item">
                                  <span >公司資訊：雲仲資訊股份有限公司</span>
                              </li>
                              <li class="menu-item">
                                  <span >統一編號：58364751
                                  </span>
                              </li>
                          </ul>
                      </div>
                  </div>
                  <div class="box-footer col-xs-12 col-sm-4 col-md-4 col-lg-4 hidden-xs">
  
                  </div>
                  <div class="box-footer col-xs-12 col-sm-4 col-md-4 col-lg-4">
                      <div class="teamo-custommenu default">
                          <ul class="menu">
                              <li class="menu-item">
                                  <a href="faq.html">常見問題</a>
                              </li>
                              <li class="menu-item">
                                  <a href="privacyRule.html">隱私權條款</a>
                              </li>

                              <li class="menu-item">
                                  <a href="userRule.html">使用者條款</a>
                              </li>
                              <li class="menu-item">
                                  <a href="creditCardRule.html">信用卡條款</a>
                              </li>
                          </ul>
                      </div>
                  </div>
              </div>
              <div class="footer-end">
                  <div class="row">
                      <div class="col-sm-12 col-xs-12">

                          <div class="coppyright">
                              © 2024 XiaHuTea 台灣 . All rights reserved
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </footer>
  

    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
<script src="assets/js/jquery-1.12.4.min.js"></script>
<script src="assets/js/jquery.plugin-countdown.min.js"></script>
<script src="assets/js/jquery-countdown.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/owl.carousel.min.js"></script>
<script src="assets/js/magnific-popup.min.js"></script>
<script src="assets/js/isotope.min.js"></script>
<script src="assets/js/jquery.scrollbar.min.js"></script>
<script src="assets/js/jquery-ui.min.js"></script>
<script src="assets/js/mobile-menu.js"></script>
<script src="assets/js/chosen.min.js"></script>
<script src="assets/js/slick.js"></script>
<script src="assets/js/jquery.elevateZoom.min.js"></script>
<script src="assets/js/jquery.actual.min.js"></script>
<script src="assets/js/fancybox/source/jquery.fancybox.js"></script>
<script src="assets/js/lightbox.min.js"></script>
<script src="assets/js/owl.thumbs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>


<script src="assets/js/frontend-plugin.js"></script>
    <script src="js/homePageMember.js"></script>

<script>
      
  document.addEventListener("DOMContentLoaded", function () {
      getUser();
      //處理輪播
      fetch('xiaHuTea/AdsList').then(response => response.json()).then(
          list =>{

              list.forEach(function (data){
                  if(data.imgUrl){
                      let imgFormat = getImgFormatByBase64(data.imgUrl);
                      let imgdata = `data:image/${imgFormat};base64,${data.imgUrl}`;
                      let adsSclicks =`<div>
        <img
          class="KunSlickImg"
          src="${imgdata}"
          alt="輪播"
        />
      </div>`;
                      //$('#homeDisplayAds').empty();
                      document.querySelector('#homeDisplayAds').insertAdjacentHTML('afterbegin',adsSclicks);
                      setTimeout(function (){
                          $(".kunClass").slick({
                              centerMode: true,
                              slidesToShow: 1,
                              slidesToScroll: 1,
                              autoplay: true,
                              autoplaySpeed: 2000,
                              arrows: false,
                          });
                          $(".slick-slide").css("filter", "blur(3px)");
                          $(".slick-center").css("filter", "none");
                          // 监听 Slick 的初始化和切换事件，以确保正确应用模糊效果
                          $(".kunClass").on(
                              "init afterChange",
                              function (event, slick, currentSlide) {
                                  // 确保在初始化和每次滑动后应用正确的滤镜
                                  $(".slick-slide").css("filter", "blur(3px)");
                                  $(".slick-slide").css("overflow", "hidden");
                                  $(".slick-center").css("filter", "none");
                                  $(".slick-center").css("overflow", "none");
                              }
                          );
                      },700);
                  }


              })
          });







    let userLogin = document.querySelector(".userLogin"); //登入按鈕
    let searchPlace = document.querySelector(".searchPlace");





    

//監聽商家
let allSotre = document.querySelectorAll('.Heart');
//
    //產生store-body
    getStoreList("/xiaHuTea/home","");

    //產生store-body
    //註冊收尋監聽
    ListenSearchStoreKeyWord();



    document.querySelector('#twoPlaceSearch').addEventListener('click',function (){
        const placeBar =document.querySelector('#PlaceSearch').value;
        const areaBar = document.querySelector('#AreaSearch').value;
        getStoreList("/xiaHuTea/search/place",placeBar+areaBar,"POST");
        setTimeout(function (){
            getDistance(0);
        },1000);


    })


      document.querySelector('#user-enter-keyword').addEventListener('keypress',function (e){
          if(e.key === "Enter"){
              if(this.value !== ""){
                  getStoreList("/xiaHuTea/search",this.value,"POST");
              }
          }
      });


    document.querySelector('#localLog-Modal').addEventListener('click',function (){
        getStoreList("/xiaHuTea/home","");
    });//點擊找附近



      //clear search
      document.querySelector('#clearSearch').addEventListener('click',function (e){
          e.preventDefault();
          document.querySelector('#user-enter-keyword').value='';
      });

      queryStr();
      logOutSkip();
      setTimeout(function (){
          document.querySelectorAll('.workTime').forEach(function (row){

              let openH = parseInt(row.textContent.split(':')[0]);
              let openM = parseInt(row.textContent.split(':')[1]);
              let now = new Date();
              nowH = now.getHours();
              nowM = now.getMinutes();

              if(openH > nowH || (openH === nowH && openM > nowM)){
                  let icon = '<span style="color:#FFA600;font-weight:bold; ">尚未營業</span>';
                  let non ='<span> &empty;</span>';
                  let parentTag = row.closest('.storeLinkCard');
                  parentTag.querySelector('a').insertAdjacentHTML('afterbegin',icon);
              }

              else{
                  let non ='<span> &nbsp;</span>';
                  let parentTag = row.closest('.storeLinkCard');
                  parentTag.querySelector('a').insertAdjacentHTML('afterbegin',non);
              }
          });

      },1000);



  }); //end dom

  $(document).ready(function () {
    var districts = {
      "新北市": ["板橋區","新莊區","中和區","新店區","永和區","三重區","蘆洲區","汐止區","土城區","樹林區","三峽區","鶯歌區","淡水區","瑞芳區","五股區","泰山區","林口區","八里區","萬里區","金山區","石門區","三芝區","石碇區","坪林區","烏來區","深坑區","平溪區","雙溪區","貢寮區"],"台北市": ["中正區","大同區","中山區","松山區","大安區","萬華區","信義區","士林區","北投區","內湖區","南港區","文山區"],"基隆市": ["仁愛區", "中正區", "信義區", "中山區", "安樂區", "暖暖區", "七堵區"],"桃園市": ["桃園區", "中壢區", "平鎮區", "八德區", "楊梅區", "蘆竹區", "大溪區", "龜山區", "龍潭區", "大園區", "觀音區", "新屋區", "復興區"],"台中市": ["中區", "東區", "南區", "西區", "北區", "北屯區", "西屯區", "南屯區", "太平區", "大里區", "霧峰區", "烏日區", "豐原區", "后里區", "石岡區", "東勢區", "和平區", "新社區", "潭子區", "大雅區", "神岡區", "大肚區", "沙鹿區", "龍井區", "梧棲區", "清水區", "大甲區", "外埔區", "大安區"],"台南市": ["中西區", "東區", "南區", "北區", "安平區", "安南區", "永康區", "歸仁區", "新化區", "左鎮區", "玉井區", "楠西區", "南化區", "仁德區", "關廟區", "龍崎區", "官田區", "麻豆區", "佳里區", "西港區", "七股區", "將軍區", "學甲區", "北門區", "新營區", "後壁區", "白河區", "東山區", "六甲區", "下營區", "柳營區", "鹽水區", "善化區", "大內區", "山上區", "新市區", "安定區"],"高雄市": ["新興區", "前金區", "苓雅區", "鹽埕區", "鼓山區", "旗津區", "前鎮區", "三民區", "楠梓區", "小港區", "左營區", "仁武區", "大社區", "岡山區", "路竹區", "阿蓮區", "田寮區", "燕巢區", "橋頭區", "梓官區", "彌陀區", "永安區", "湖內區", "鳳山區", "大寮區", "林園區", "鳥松區", "大樹區", "旗山區", "美濃區", "六龜區", "內門區", "杉林區", "甲仙區", "桃源區", "那瑪夏區", "茂林區", "茄萣區"],"新竹市": ["東區", "北區", "香山區"],"新竹縣": ["竹北市", "竹東鎮", "新埔鎮", "關西鎮", "湖口鄉", "新豐鄉", "芎林鄉", "橫山鄉", "北埔鄉", "寶山鄉", "峨眉鄉", "尖石鄉", "五峰鄉"],"苗栗縣": ["苗栗市", "通霄鎮", "苑裡鎮", "竹南鎮", "頭份市", "後龍鎮", "卓蘭鎮", "大湖鄉", "公館鄉", "銅鑼鄉", "南庄鄉", "頭屋鄉", "三義鄉", "西湖鄉", "造橋鄉", "三灣鄉", "獅潭鄉", "泰安鄉"],"彰化縣": ["彰化市", "鹿港鎮", "和美鎮", "線西鄉", "伸港鄉", "福興鄉", "秀水鄉", "花壇鄉", "芬園鄉", "員林市", "溪湖鎮", "田中鎮", "大村鄉", "埔鹽鄉", "埔心鄉", "永靖鄉", "社頭鄉", "二水鄉", "田尾鄉", "埤頭鄉", "芳苑鄉", "大城鄉", "竹塘鄉", "溪州鄉"],"南投縣": ["南投市", "埔里鎮", "草屯鎮", "竹山鎮", "集集鎮", "名間鄉", "鹿谷鄉", "中寮鄉", "魚池鄉", "國姓鄉", "水里鄉", "信義鄉", "仁愛鄉"],"雲林縣": ["斗六市", "斗南鎮", "虎尾鎮", "西螺鎮", "土庫鎮", "北港鎮", "林內鄉", "古坑鄉", "大埤鄉", "莿桐鄉", "褒忠鄉", "二崙鄉", "崙背鄉", "麥寮鄉", "臺西鄉", "東勢鄉", "元長鄉", "四湖鄉", "口湖鄉", "水林鄉"],"嘉義市": ["東區", "西區"],"嘉義縣": ["太保市", "朴子市", "布袋鎮", "大林鎮", "民雄鄉", "溪口鄉", "新港鄉", "六腳鄉", "東石鄉", "義竹鄉", "鹿草鄉", "水上鄉", "中埔鄉", "竹崎鄉", "梅山鄉", "番路鄉", "大埔鄉", "阿里山鄉"],"屏東縣": ["屏東市", "潮州鎮", "東港鎮", "恆春鎮", "萬丹鄉", "長治鄉", "麟洛鄉", "九如鄉", "里港鄉", "鹽埔鄉", "高樹鄉", "萬巒鄉", "內埔鄉", "竹田鄉", "新埤鄉", "枋寮鄉", "新園鄉", "崁頂鄉", "林邊鄉", "南州鄉", "佳冬鄉", "琉球鄉", "車城鄉", "滿州鄉", "枋山鄉", "三地門鄉", "霧臺鄉", "瑪家鄉", "泰武鄉", "來義鄉", "春日鄉", "獅子鄉", "牡丹鄉"],"台東縣": ["台東市", "成功鎮", "關山鎮", "卑南鄉", "鹿野鄉", "池上鄉", "東河鄉", "長濱鄉", "太麻里鄉", "大武鄉", "達仁鄉", "綠島鄉", "蘭嶼鄉", "延平鄉", "金峰鄉", "海端鄉"],"花蓮縣": ["花蓮市", "鳳林鎮", "玉里鎮", "新城鄉", "吉安鄉", "壽豐鄉", "光復鄉", "豐濱鄉", "瑞穗鄉", "萬榮鄉", "富里鄉", "秀林鄉"],"宜蘭縣": ["宜蘭市", "羅東鎮", "蘇澳鎮", "頭城鎮", "礁溪鄉", "壯圍鄉", "員山鄉", "冬山鄉", "五結鄉", "三星鄉", "大同鄉", "南澳鄉"],"澎湖縣": ["馬公市", "湖西鄉", "白沙鄉", "西嶼鄉", "望安鄉", "七美鄉"],"金門縣": ["金城鎮", "金湖鎮", "金沙鎮", "金寧鄉", "烈嶼鄉", "烏坵鄉"],"連江縣": ["南竿鄉", "北竿鄉", "莒光鄉", "東引鄉"]};

    $("#PlaceSearch").change(function () {
      var selectedCity = $(this).val();
      var selectedArea = $("#AreaSearch");


      if (selectedCity) {
        selectedArea.empty(); //清空之前選單
        selectedArea.append('<option value="">請選擇區域</option>');
        districts[selectedCity].forEach(function (row) {
          selectedArea.append(
            '<option value="' + row + '">' + row + "</option>"
          );
        });
      }
    }); //選擇了縣市

    $("#citySelect").change(function () {
      var selectedCity = $(this).val();
      var districtSelect = $("#districtSelect");

      districtSelect.empty(); // 清空之前的選項

      if (selectedCity) {
        districtSelect.prop("disabled", false);
        districtSelect.append('<option value="">請選擇區域</option>');

        districts[selectedCity].forEach(function (district) {
          districtSelect.append(
            '<option value="' + district + '">' + district + "</option>"
          );
        });
      } else {
        districtSelect.prop("disabled", true);
        districtSelect.append('<option value="">請先選擇城市</option>');
      }
    });





  });
</script>

    
    <script>
        function getDistance(status = 1) {



            const drinkAddressTags = document.querySelectorAll(".drinkAddress"); // 飲料店地址

            function error() {
                if(status === 1){
                    swal.fire({text:"瀏覽器不支援定位"});
                }


            }

            function success(position) {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;
                let userPosition = document.querySelector('#user-place').value !== "" ? document.querySelector('#user-place').value : new google.maps.LatLng(latitude, longitude) ;
                if(status === 1){

                    sessionStorage.setItem('userPosition', userPosition);
                }else{
                    if(!sessionStorage.getItem('userPosition')){
                        userPosition = sessionStorage.getItem('userPosition');
                        if(!userPosition){
                            return;
                        }

                    }

                }








                const service = new google.maps.DistanceMatrixService();
                const drinkAddressTags = document.querySelectorAll(".drinkAddress"); // 飲料店地址


                drinkAddressTags.forEach(function (drinkAddress) {

                    service.getDistanceMatrix(
                        {
                            origins: [userPosition],
                            destinations: [drinkAddress.getAttribute("data-address")],
                            travelMode: google.maps.TravelMode.DRIVING, //開車
                            unitSystem: google.maps.UnitSystem.METRIC, // 公里
                            avoidHighways: false,
                            avoidTolls: false,
                        },
                        callback
                    );

                    function callback(response, respStatus) {
                        if (respStatus === "OK") {
                            // 取得使用者位置後 首先抓取 每家店的位址 進行計算

                            const origin = response.originAddresses[0];
                            const destination = response.destinationAddresses[0];


                            if (response.rows[0].elements[0].status === "OK") {
                                const distance = response.rows[0].elements[0].distance.text;

                                const sotreFooter = $(drinkAddress).nextAll().eq(1);


                                sotreFooter.find('.sotreDistance').text();

                                sotreFooter
                                    .find(".sotreDistance")
                                    .html(
                                        `&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;約${distance}`
                                    );

                                //超過10km排除

                                if(status  && parseInt(distance) > 10){

                                    let te =sotreFooter.closest(".storeLinkCard");
                                    $(te).remove();

                                }


                                // result.textContent = `從 ${origin} 到 ${destination} 的距離是 ${distance}`;
                            } else {
                                const sotreFooter = $(drinkAddress).nextAll().eq(1);
                                sotreFooter.find(".sotreDistance").text(`計算失敗`);
                            }
                        } else {
                            const sotreFooter = $(drinkAddress).nextAll().eq(1);
                            sotreFooter.find(".sotreDistance").text(`計算失敗`);
                        }
                        // 計算完成後重置狀態

                    }
                });
            }



            if (!navigator.geolocation) {
                status.textContent = "不支援地理定位";


            } else {
                status.textContent = "加載中...";
                navigator.geolocation.getCurrentPosition(success, error);
            }

        }


      function initMap() {



        document
          .querySelector("#autoCatchUserPlace")
          .addEventListener("click", function (){


              getDistance();
              //檢查結果
              setTimeout(function (){
                  if(!document.querySelector('.storeLinkCard')){
                      Swal.fire({
                          text:"該區域方圓十公里內沒有店家"
                      });
                  }
              },1000);
          });
      }

        window.onload = function () {
            if (!window.google) {
                console.error("Google Maps API not loaded.");
            }
            initMap(); // 確保在頁面加載後初始化地圖
        }

      function ListenSearchStoreKeyWord(){
        //監聽輸入關鍵字
        document.querySelector('#forSearchStore').addEventListener('click',function (e){
          //停止預設行為
          e.preventDefault();
          let uservalue = (document.querySelector("#user-enter-keyword").value).trim();
          if(uservalue !==""){
            let data = uservalue;

            getStoreList("/xiaHuTea/search",data,"POST");

            setTimeout(function (){
                getDistance(0);
            },1000);



          }


        })

      }

      function getStoreList(url,data,method="GET"){

        $.ajax({
          dataType: "json",
          contentType: 'application/json',
          method:method,
          url: url,
          data: data,
          success: function (data){
            $('#store-body').empty(); //清空
            if( data.length === 0  ){

              swal.fire({
                text:"找不到店家",
                confirmButtonText: "回首頁",
              }).then((res) => {
                if(res.isConfirmed){
                  getStoreList("/xiaHuTea/home","");
                }
              });
            }



            data.forEach(function (row) {
                const base64Img = row.logo;
                let imgid = "img" + row.storeId;
                let ot = row.openingHours;
                let et = row.closingHours;
                let storeScore = row.score ? row.score : '統計中'
                let imgTime = `<img
                    src=""
                    alt=""
                    className="rounded KunIndexSotreImg"
                    id="${imgid}"
                />`;

                if (ot) {
                    ot = ot.substring(0, 5);
                    now = new Date();





                } else {
                    ot = '未設置';
                }
                if (et) {
                    et = et.substring(0, 5);
                } else {
                    et = '未設置';
                }
                let isdelieve = '';
                if (row.isDelivery) {
                    isdelieve = '<i class="fa-1.5x fa-solid fa-truck" style="color: #73B4BA"></i>';
                } else {
                    isdelieve = '';
                }

                let str = `
<figure class="col-3 figure my-5 Heart storeLinkCard shadow mx-3 bg-body rounded" >
<a href="productMenu.html?storeId=${row.storeId}">
          <img
            src=""
            alt=""
            class="rounded KunIndexSotreImg"
            id="${imgid}"
          />
          </a>
          <div class="row">
            <figcaption
              class="figure-caption col-6 IndexImgNameFontSize drinkAddress"
              data-address="${row.storeAddress}"

            >
             ${row.storeName}
            </figcaption>
            <figcaption class="figure-caption col">
              ${isdelieve}
            </figcaption>
            <figcaption class="figure-caption col-12 footer2">
              <i class="KunStar fa-solid fa-star"></i
              ><span class="KunRank">${storeScore}</span
              >&nbsp;‧<span class="workTime">${ot}~${et}</span>&nbsp;&nbsp;‧<span class="sotreDistance"
                >未定位</span
              >
            </figcaption>
          </div>
        </figure>`;
                document.querySelector('#store-body').insertAdjacentHTML("afterbegin", str);

                storeImage = document.querySelector(`#${imgid}`);

                let imgFormat;
                if (base64Img != null) {

                    if (base64Img.startsWith("iVBORw0KGgo")) {
                        imgFormat = "png"; // PNG 圖片的 base64 開頭
                    } else if (base64Img.startsWith("/9j/")) {
                        imgFormat = "jpeg"; // JPEG 圖片的 base64 開頭
                    } else if (base64Img.startsWith("R0lGODlh")) {
                        imgFormat = "gif"; // JPEG 圖片的 base64 開頭
                    } else if (base64Img.startsWith("Qk0")) {
                        imgFormat = "bmp"; // JPEG 圖片的 base64 開頭
                    } else if (base64Img.startsWith("UklGR")) {
                        imgFormat = "webp"; // JPEG 圖片的 base64 開頭
                    } else if (base64Img.startsWith("PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmci")) {
                        imgFormat = "svg+xml"; // JPEG 圖片的 base64 開頭
                    } else {
                        console.error("不支持的圖片格式");
                    }
                }


                if (imgFormat) {
                    // 確保有對應的 img 元素

                    storeImage.src = `data:image/${imgFormat};base64,${base64Img}`;
                }else{
                    storeImage.src='../img/xiahutealogo.jpg';
                }


            });
          }
        });
      }


        function getUserLocation() {
            if ("geolocation" in navigator) {
                /* geolocation is available */
              //監聽點擊定位
              document.querySelector('#autoCatchUserPlace').addEventListener('click',function () {


                  navigator.geolocation.getCurrentPosition(function (position) {


                      const lng = position.coords.longitude;
                      const lat = position.coords.latitude;

                      document.querySelectorAll('.drinkAddress').forEach(function (row){

                      });



                  });

              });
          } else {
              document.querySelector('#user-place').placeholder="不支援定位請輸入地址";
          }

      }
    </script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAm4iwqRUtQfPBubWGDHpMB9cQ4uLvkM4I&libraries=places&v=weekly&callback=initMap"></script>


  </body>
</html>
