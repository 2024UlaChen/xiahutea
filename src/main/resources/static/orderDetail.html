<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨‚å–®æ˜ç´°</title>

  <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png"/>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i&display=swap"
        rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/font-awesome.min.css">
  <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
  <link rel="stylesheet" href="assets/css/animate.min.css">
  <link rel="stylesheet" href="assets/css/jquery-ui.css">
  <link rel="stylesheet" href="assets/css/slick.css">
  <link rel="stylesheet" href="assets/css/chosen.min.css">
  <link rel="stylesheet" href="assets/css/pe-icon-7-stroke.css">
  <link rel="stylesheet" href="assets/css/magnific-popup.min.css">
  <link rel="stylesheet" href="assets/css/lightbox.min.css">
  <link rel="stylesheet" href="assets/js/fancybox/source/jquery.fancybox.css">
  <link rel="stylesheet" href="assets/css/jquery.scrollbar.min.css">
  <link rel="stylesheet" href="assets/css/mobile-menu.css">
  <link rel="stylesheet" href="assets/fonts/flaticon/flaticon.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="css/general.css">
  <!-- SweetAlert2 CSSæ¨£å¼ -->
  <link rel="stylesheet" href="/cms/plugins/sweetalert2/sweetalert2.css">

  <style>
      .material-symbols-outlined {
          font-variation-settings: 'FILL' 1, /*æ˜¯å¦å¡«æ»¿ 0 or 1*/ 'wght' 400, /*ç²—ç´° 100 ~ 700*/ 'GRAD' 0, /*è¦–è¦ºå¹³è¡¡ç²—ç´° -25 0 200*/ 'opsz' 48 /*å¤§å°*/
      }
  </style>
  <style>
      /* æ•´å€‹å€å¡Š */
      .left-sidebar .content-area {
          margin-top: 10px;
          float: left;
          width: 100%;
          border-radius: 1%;
      }

      div.shop-top-control {
          display: flex;
          width: 100%;
          height: 100%;

      }

      /* å·¦å³ å…©å€*/
      div.order_div {
          margin: 5px;
          padding: 5px;
          width: 50%;
          height: 100%;
          border-radius: 1%;
          min-width: 450px;
      }

      /* åº—å®¶å€å¡Š */
      div#store_info {
          background-color: white;
          text-align: left;
          display: inline-flex;
          padding: 20px 0 20px 0;
          border-radius: 1%;
          width: 100%;
          height: 20%;
      }

      div#store_info div.store_name {
          font-size: 20px;
          font-weight: bold;
          line-height: 2;
          color: #517d81;
      }

      /* åº—å®¶å€å¡Š > åº—å®¶logo */
      div.store_logo {
          width: 30%;
          height: 30%;
          min-width: 50px;
          max-width: 80px;
          aspect-ratio: 1/1; /* è¨­å®šå…ƒç´ çš„å¯¬é«˜æ¯”ä¾‹ç‚º1:1 */
          margin: 15px auto; /* é€™å€‹ç½®ä¸­æ–¹å¼(å¥½åƒ)åªæœƒå°å€å¡Šå…ƒç´ ç”Ÿæ•ˆ */
          overflow: hidden;
          border: 1px solid #00000020;
          border-radius: 50%;
      }

      div.store_logo img.store_logo_img {
          width: 100%;
          height: 100%;
          object-fit: cover;
      }

      /*  åº—å®¶å€å¡Š > åº—å®¶è©³ç´° */
      div.store_detail {
          width: 60%;
      }

      div.store_detail div.store_name {
          font-weight: bold;
          color: black;
      }

      div.store_detail div.store_info_text span {
          color: black;
          line-height: 1;
      }

      /*  åº—å®¶å€å¡Š > åº—å®¶è©³ç´° */
      div.store_others {
          width: 20%;
          display: inline;
      }

      /* åº—å®¶å€å¡Š > btnçˆ­è­°&è©•åˆ† */
      button.btn_order_star, button.btn_dispute_apply {
          float: right; /* å°‡æŒ‰éˆ•æµ®å‹•åˆ°å³é‚Š */
          margin-right: 20px;
          padding: 0;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-align: center;
          width: 100px;
          height: 40px;
          background-color: #73B4BA;
          border: 1px solid #73B4BA;
          font-size: 16px;
          color: white;
          border-radius: 5px;
      }

      button.btn_dispute_apply {
          margin-top: 15px;
      }

      button.btn_order_star.-close, button.btn_dispute_apply.-close {
          background-color: #6c757d;
          border: 1px solid #6c757d;
      }

      /* btn å›ä¸Šä¸€é  */
      .order_btn_back_div {
          display: flex;
          justify-content: center; /* æ°´å¹³ç½®ä¸­ */
      }

      .order_btn_back {
          padding: 0;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-align: center;
          width: 100px;
          height: 40px;
          background-color: #F8F9FA;
          border: 1px solid #73B4BA;
          font-size: 16px;
          color: #53a0a7;
          border-radius: 5px;
      }

      /* è¨‚å–®æ˜ç´°å€å¡Š */
      div.order_info {
          width: 100%;
          height: 80%;
          padding-top: 5px;
          margin: 5px 0 0 0;
          background-color: white;
          border-radius: 1%;
      }

      div.order_info table.order_info_tb {
          color: black;
          border-collapse: collapse; /* åˆä½µé‚Šæ¡† */
          width: 100%; /* èª¿æ•´å¯¬åº¦ */
          border-top: 0;
      }

      div.order_info th {
          font-weight: bold;
          width: 120px;
      }

      div.order_info th, td {
          border-bottom: 2px solid #c2c1c172; /* è¨­ç½®ä¸‹æ¡†ç·šï¼Œé»‘è‰²å¯¦ç·š */
          border-top: 0;
          padding: 8px; /* è¨­ç½®å…§é‚Šè· */
          text-align: left; /* æ–‡å­—é å·¦ */
      }

      /* å•†å“å€å¡Š */
      div.product_info {
          width: 100%;
          height: 100%;
          background-color: white;
          border-radius: 1%;
      }

      div.product_info li.product_li {
          padding: 5px;
          list-style-type: none;
      }

      div.product_info li.product_li ul {
          padding: 20px;
          margin: 5px;
          background-color: #f1f1f1;
      }

      div.product_info li.product_li ul.product_ul div.product_name {
          font-weight: bold;
          color: black;
          line-height: 2;
          font-size: 16px;
      }

      div.product_info li.product_li ul.product_ul span {
          line-height: 2;
          font-size: 14px;
      }

      /* å•†å“å€å¡Š-ç¸½è¨ˆé‡‘é¡ */
      div.product_info div.product_total {
          padding: 10px 20px;
          color: black;
      }

      div.product_info div.pay_money {
          padding: 10px 20px 20px 20px;
          font-weight: bold;
          color: #517d81;
          font-size: 18px;
      }

      /* è¨‚å–®è©•åˆ†-ç‡ˆç®± */
      button.btn_order_star {
          cursor: pointer;
      }

      #lightbox_star {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100vh;
          background-color: hsla(0, 0%, 0%, .5);
      }

      .none {
          display: none;
      }

      #lightbox_star > form {
          background-color: white;
          width: 90%;
          max-width: 600px;
          border-radius: 10px;
          height: 550px;
          padding: 10px;
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
      }

      .star_title_div {
          height: 300px; /* è¨­å®šé«˜åº¦ï¼Œä»¥ä¾¿æ–¼å‚ç›´ç½®ä¸­ */
      }

      p.star_title {
          margin-top: 30px;
          font-weight: bold;
          color: black;
          font-size: 18px;
          text-align: center;
      }

      .star_order_id_div {
          display: grid;
          place-items: center;
          margin-bottom: 50px;
      }

      input#star_order_id {
          text-align: center;
          height: 30px;
          width: 300px;
          border: 0 solid #bebebee4;
          font-weight: bold;
          color: black;
          font-size: 18px;
      }

      /* ==== ç‡ˆç®± > è©•åˆ†æ˜Ÿè™Ÿå€å¡Š ===== */
      div.star_block {
          margin-top: 10px;
          margin-bottom: 50px;
          display: flex;
          justify-content: center; /* æ°´å¹³ç½®ä¸­ */
          padding: 5px; /* æ·»åŠ å…§é‚Šè· */
      }

      /* ==== ç‡ˆç®± > å–®å€‹æ˜Ÿè™Ÿå€å¡Š ===== */
      div.star_block > span.star {
          font-size: 30px;
          cursor: pointer;
          display: inline-block;
          margin-right: 3px;
      }

      /* ==== ç‡ˆç®± > æ˜Ÿè™Ÿè®Šè‰² ===== */
      div.star_block > span.star.-on {
          color: #FAC792;
      }

      /* ===== ç‡ˆç®± > è©•åˆ†å»ºè­°å€å¡Š ===== */
      textarea#star_text {
          border: 1px rgba(128, 128, 128, 0.5) solid;
          margin: 0 10% 10px 10%;
          max-height: 100px;
          min-height: 100px;
          max-width: 80%;
          min-width: 80%;
          padding: 10px;
      }

      /* ===== ç‡ˆç®± > è©•åˆ†æŒ‰éˆ• ===== */
      div.btn_star_close_div {
          display: flex;
          justify-content: center; /* æ°´å¹³ç½®ä¸­ */
          padding: 5px; /* æ·»åŠ å…§é‚Šè· */
      }

      div.btn_star_close_div > button#demo1 {
          padding: 10px 20px; /* æŒ‰éˆ•å…§éƒ¨çš„å…§é‚Šè· */
          margin: 10px;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-align: center;
          width: 100px;
          height: 40px;
          background-color: #73B4BA;
          border: 1px solid #73B4BA;
          font-size: 16px;
          color: white;
          border-radius: 5px;
      }

      div.btn_star_close_div > button#btn_star_close {
          padding: 10px 20px; /* æŒ‰éˆ•å…§éƒ¨çš„å…§é‚Šè· */
          margin: 10px;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-align: center;
          width: 100px;
          height: 40px;
          background-color: #F8F9FA;
          border: 1px solid #73B4BA;
          font-size: 16px;
          color: #53a0a7;
          border-radius: 5px;
      }
  </style>
</head>

<body>
<div class="header"></div>

<!--åŠŸèƒ½ å€å¡Š-->
<div class="main-content main-content-product left-sidebar">
  <div class="container">
    <div class="row">
      <div class="content-area shop-grid-content no-banner col-lg-9 col-md-9 col-sm-12 col-xs-12">
        <div class="shop-top-control">
          <div class="order_div">
            <div id="store_info">
              <!--  JS              -->
            </div>
            <div class="order_info">
              <table class="order_info_tb">
                <!-- JS             -->
              </table>
            </div>

            <!-- è¨‚å–®è©•åˆ†ç‡ˆç®± -->
            <div id="lightbox_star" class="none">
              <form>
                <div class="star_title_div">
                  <!--  JS                -->
                </div>
              </form>
            </div>
            <!--/ è¨‚å–®è©•åˆ†ç‡ˆç®± -->

            <div class="order_btn_back_div">
              <button class="order_btn_back">å›ä¸Šä¸€é </button>
            </div>
          </div>
          <div class="order_div">
            <div class="product_info">
              <!--  JS                -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="footer"></div>

<script src="assets/js/jquery-1.12.4.min.js"></script>
<script src="assets/js/jquery.plugin-countdown.min.js"></script>
<script src="assets/js/jquery-countdown.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/owl.carousel.min.js"></script>
<script src="assets/js/magnific-popup.min.js"></script>
<script src="assets/js/isotope.min.js"></script>
<script src="assets/js/jquery.scrollbar.min.js"></script>
<script src="assets/js/jquery-ui.min.js"></script>
<script src="assets/js/mobile-menu.js"></script>
<script src="assets/js/chosen.min.js"></script>
<script src="assets/js/slick.js"></script>
<script src="assets/js/jquery.elevateZoom.min.js"></script>
<script src="assets/js/jquery.actual.min.js"></script>
<script src="assets/js/fancybox/source/jquery.fancybox.js"></script>
<script src="assets/js/lightbox.min.js"></script>
<script src="assets/js/owl.thumbs.min.js"></script>
<script src="assets/js/jquery.scrollbar.min.js"></script>
<script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyC3nDHy1dARR-Pa_2jjPCjvsOR4bcILYsM'></script>
<script src="assets/js/frontend-plugin.js"></script>
<script src="assets/js/newjs.js"></script>
<script src="./js/general.js"></script>
<!-- sweet alert  -->
<script src="cms/plugins/sweetalert2/sweetalert2.all.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // å–å¾—sessionStorageæœƒå“¡ID
        const memberData = JSON.parse(sessionStorage.getItem("memberData"));
        const customerId = memberData.data.customerId;
        if(!memberData || customerId == null){
            Swal.fire("è«‹å…ˆç™»å…¥æœƒå“¡");
            location.href = `./homePage.html`;
            return;
        }
        // å–å¾—URLçš„æŸ¥è©¢åƒæ•¸
        function getQueryParam(param) {
            let urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        //-------------------------------------------------------
        // 0. é¡¯ç¤ºæ˜ç´°
        init();
        function init() {
            let orderId = getQueryParam("orderId");
            if (orderId) {
                fetch(`/order/member/detail/${orderId}`)
                    .then(resp => resp.json())
                    .then(data =>{
                        // console.log(data)
                        showDB(data); // é¡¯ç¤ºè³‡æ–™
                    })
                    .catch((error) => {
                        console.log("éŒ¯èª¤åŸå› :" + error);
                    });
            }
        }

        function showDB(data) {
            let storeInfoHtml;
            storeInfoHtml = `
                 <div class="store_logo">
                    <img class="store_logo_img" src="data:${data.orders.store.contentType};base64,${data.orders.store.logo}" alt="åº—å®¶logo">
                </div>
                <div class="store_detail">
                    <div class="store_name">${data.orders.store.storeName}</div>
                    <span><b>åº—å®¶è³‡è¨Š</b></span><br>
                    <div class="store_info_text">
                        <span>ğŸ“</span><span>${data.orders.store.storePhone}</span><br>
                        <span>ğŸ“</span><span>${data.orders.store.storeAddress}</span>
                    </div>
                </div>
                <div class="store_others">
                    <button type="button" class="btn_order_star">è¨‚å–®è©•åˆ†</button>
                    <button class="btn_dispute_apply">çˆ­è­°ç”³è«‹</button>
                </div>
            `;
            const store_info_el = document.getElementById("store_info");

            let orderInfoHtml;
            orderInfoHtml = `
                <tbody>
                    <tr>
                        <th>è¨‚å–®ç·¨è™Ÿ</th>
                        <td>${data.orders.orderId}</td>
                    </tr>
                    <tr>
                        <th>è¨‚å–®ç‹€æ…‹</th>
                        <td>${statusText(data.orders.orderStatus)}</td>
                    </tr>
                    <tr>
                        <th>ä»˜æ¬¾æ–¹å¼</th>
                        <td>${paymentMethodText(data.orders.paymentMethod)}</td>
                    </tr>
                    <tr>
                        <th>ä»˜æ¬¾é‡‘é¡</th>
                        <td>${data.orders.paymentAmount}</td>
                    </tr>
                    <tr>
                        <th>ç™¼ç¥¨é–‹ç«‹æ–¹å¼</th>
                        <td>[${invoiceText(data.orders.invoiceMethod)}] ${nullText(data.orders.invoiceNo)} ${nullText(data.orders.invoiceVat)} ${nullText(data.orders.invoiceCarrier)} </td>
                    </tr>
                    <tr>
                        <th>å–è²¨æ–¹å¼</th>
                        <td>${receiverMethodText(data.orders.receiverMethod)}</td>
                    </tr>
                     <tr>
                        <th>å–è²¨æ™‚é–“</th>
                        <td id="receiver_date">${data.orders.receiverDatetime}</td>
                    </tr>
                    <tr>
                        <th>å–è²¨äºº</th>
                        <td>${data.orders.receiverName}</td>
                    </tr>
                    <tr>
                        <th>å–è²¨äººé›»è©±</th>
                        <td>${data.orders.receiverPhone}</td>
                    </tr>
                    <tr>
                        <th>å–è²¨äººåœ°å€</th>
                        <td>${nullText(data.orders.receiverAddress)}</td>
                    </tr>
                    <tr>
                        <th>è¨‚å–®å‚™è¨»</th>
                        <td>${nullText(data.orders.orderNote)}</td>
                    </tr>
                    <tr>
                        <th>è¨‚å–®æˆç«‹æ™‚é–“</th>
                        <td id="order_date">${data.orders.orderCreateDatetime}</td>
                    </tr>
                </tbody>
        `;
            document.getElementsByClassName("order_info_tb")[0].innerHTML = orderInfoHtml;
            //-------------------------------------------------------------------

            if (store_info_el) {
                store_info_el.innerHTML = storeInfoHtml;

                // 1. btn çˆ­è­°ç”³è«‹
                // 1.1 ç•¶è¨‚å–®å»ºç«‹æ—¥è¶…é2å¤© é–å®šçˆ­è­°btn
                const btn_dispute_apply = store_info_el.querySelector(".btn_dispute_apply");
                let receiver_date_el = document.getElementById("receiver_date");
                if (receiver_date_el) {
                    const date_text = receiver_date_el.textContent; // å–å¾— <td> è£¡çš„æ–‡æœ¬
                    const date_part1 = date_text.split(' '); // ["2024/08/07", "14:30"]
                    const date_part2 = date_part1[0].split('/'); // ["2024", "08", "07"]
                    const date_part3 = date_part1[1].split(':'); // ["14", "30"]
                    const receiver_date = new Date(
                        parseInt(date_part2[0]), // å¹´
                        parseInt(date_part2[1]) - 1, // æœˆ (å¾ 0 é–‹å§‹)
                        parseInt(date_part2[2]), // æ—¥
                        parseInt(date_part3[0]), // æ™‚
                        parseInt(date_part3[1])  // åˆ†
                    );
                    const receiver_date_2day = new Date(receiver_date);
                    receiver_date_2day.setDate(receiver_date_2day.getDate() + 2); // è¨‚å–®æ—¥æœŸ+åŠ å…©å¤©
                    let now_date = new Date(); //ç¾åœ¨çš„æ™‚é–“

                    if (receiver_date_2day < now_date) {
                        btn_dispute_apply.classList.add("-close");
                        btn_dispute_apply.setAttribute("disabled", "disabled");
                        btn_dispute_apply.innerHTML = "è¨‚å–®å®Œæˆ";
                    }
                }

                // 1.2 çˆ­è­°btn å¯é»æ“Šæ™‚ linkçˆ­è­°ç”³è«‹è¡¨
                btn_dispute_apply.addEventListener("click", function () {
                    location.href = `./orderDispute.html?orderId=${data.orders.orderId}`;
                });

                // 1.3 å¦‚æœå¾Œç«¯å·²æœ‰çˆ­è­°è³‡æ–™ æ›´æ”¹ é–å®šçˆ­è­°btn
                if(data.disputeOrder && data.disputeOrder.disputeOrderId){
                    btn_dispute_apply.classList.add("-close");
                    btn_dispute_apply.setAttribute("disabled", "disabled");
                    btn_dispute_apply.innerHTML="å·²é€çˆ­è­°";
                }
            }

            let productInfoHtml;
            productInfoHtml = `
              <div class="product_list">
                  <li class="product_li">
                        <!--   å•†å“æ˜ç´°å¯«åœ¨JS    -->
                  </li>
              </div>
              <div class="product_total">
                   <span>å•†å“  x  ${data.orders.orderProductQuantity}</span>
              </div>
              <div class="pay_money">
                  <span>è¨‚å–®é‡‘é¡</span>
                  <span class="pay_money_num">$ ${data.orders.productAmount}</span>
              </div>
        `;
            document.getElementsByClassName("product_info")[0].innerHTML = productInfoHtml;

            let productHtml = "";
            let detailList = data.orderDetails;
            for (let i = 0; i < detailList.length; i++) {
                productHtml += `
                <ul class="product_ul">
                    <div class="product_name">${detailList[i].product.productName}  ( ${detailList[i].product.size} )</div>
                    <span>${detailList[i].productSugar} / ${detailList[i].productTemperature} / ${detailList[i].productAddMaterials} / $ ${detailList[i].productPrice} / ${detailList[i].productQuantity} é …</span>
                </ul>
            `;
            }
            document.getElementsByClassName("product_li")[0].innerHTML = productHtml;

            let starHtml;
            starHtml = `
                <p class="star_title">è¨‚å–®ç·¨è™Ÿ</p>
                <div class="star_order_id_div">
                    <label for="star_order_id"></label><input id="star_order_id" type="text" name="star_order_id" value="${data.orders.orderId}" disabled>
                </div>
                <p class="star_title">é—œæ–¼è¨‚å–®çš„è©•åˆ†</p>
                <div class="star_block">
                    <span class="star" data-star="1"><i class="fa fa-star"></i></span>
                    <span class="star" data-star="2"><i class="fa fa-star"></i></span>
                    <span class="star" data-star="3"><i class="fa fa-star"></i></span>
                    <span class="star" data-star="4"><i class="fa fa-star"></i></span>
                    <span class="star" data-star="5"><i class="fa fa-star"></i></span>
                </div>
                <p class="star_title">é—œæ–¼è¨‚å–®çš„æ„è¦‹</p>
                <label for="star_text"></label><textarea id="star_text" type="text" name="star_text" placeholder="å»ºè­°å¯å°å£å‘³ã€åŒ…è£ç­‰ç´°ç¯€æä¾›è©•è«–"></textarea>
                <div class="btn_star_close_div" >
                    <button type="button" id="demo1" class="btn_star_submit">é€å‡º</button>
                    <button type="button" id="btn_star_close">å–æ¶ˆ</button>
                </div>
            `;
            const star_title_el = document.getElementsByClassName("star_title_div")[0];
            if (star_title_el) {
                star_title_el.innerHTML = starHtml;

                // 2. btn è¨‚å–®è©•åˆ†
                // 2.0 åˆ¤æ–·ç‡ˆç®± btnç‹€æ…‹  disabled cssæ¨£å¼
                const btn_order_star = store_info_el.querySelector(".btn_order_star");
                if(btn_order_star){
                    if (data.orders.orderScore != null){
                        btn_order_star.classList.add("-close");
                        btn_order_star.setAttribute("disabled", "disabled");
                        btn_order_star.innerHTML = "è©•åˆ†å®Œæˆ";
                    }
                    // 2.1 ç‡ˆç®±æ“ä½œ > æ‰“é–‹ç‡ˆç®±
                    let lightbox_el = document.getElementById("lightbox_star");
                    btn_order_star.addEventListener("click", function () {
                        lightbox_el.classList.remove("none");
                    });
                    // 2.2 ç‡ˆç®±æ“ä½œ > é—œé–‰ç‡ˆç®±
                    const btn_star_close = document.getElementById("btn_star_close");
                    btn_star_close.addEventListener("click", function () {
                        lightbox_el.classList.add("none");
                    });
                    lightbox_el.addEventListener("click", function () {
                        this.classList.add("none");
                    });
                    lightbox_el.querySelector("form").addEventListener("click", function (e) {
                        e.stopPropagation();
                    });
                }

                // 2.1.1 æ‰“é–‹ç‡ˆç®± > è©•åˆ†æ˜Ÿæ˜Ÿé»æ“Š
                let span_el;
                let star_title_div_el = document.getElementsByClassName("star_title_div")[0];
                star_title_div_el.addEventListener("click", function (e) {
                    if (e.target.closest("span.star")) {
                        span_el = e.target.closest("span.star");
                        let current_star = parseInt(span_el.getAttribute("data-star"));
                        let star_span = span_el.closest("div.star_block").querySelectorAll("span.star");
                        star_span.forEach(function (star_item, i) {
                            if (parseInt(star_item.getAttribute("data-star")) <= current_star) {
                                star_span[i].classList.add("-on");
                            } else {
                                star_span[i].classList.remove("-on");
                            }
                        });
                    }
                });

                // 2.1.2 æ‰“é–‹ç‡ˆç®± > btné€å‡º é»æ“Šå¾Œæª¢æŸ¥æ¬„ä½ï¼Œé€è³‡æ–™åˆ°å¾Œç«¯ï¼Œé—œé–‰è¦–çª—å¾Œdisabled btn
                const btn_star_submit = star_title_el.querySelector(".btn_star_submit");
                btn_star_submit.addEventListener("click", function (e) {
                    let order_id = document.getElementById("star_order_id");
                    const order_score = getStar();
                    let order_feedback = document.getElementById("star_text");
                    if (order_score > 0) {
                        let star_data = {
                            orderId: order_id.innerText,
                            orderScore: order_score + '',
                            orderFeedback: order_feedback.value
                        };

                        let orderId = getQueryParam("orderId");
                        if (orderId) {
                            fetch(`/order/member/star/${orderId}`, {
                                method: "PUT",
                                headers: {
                                    'Content-Type': 'application/json' // è¨­ç½®å…§å®¹é¡å‹ç‚º JSON
                                },
                                body: JSON.stringify(star_data) // å°‡è³‡æ–™è½‰ç‚º JSON æ ¼å¼
                            })
                                .then(res => res.json())
                                .then(data => {
                                    if (data.successful) {
                                        console.log(data.message);
                                        Swal.fire({
                                            title: 'å·²é€å‡ºè©•åˆ†',
                                            text: '',
                                            icon: 'success',
                                            showConfirmButton: true  // ç¢ºèªæŒ‰éˆ•
                                        }).then(() => {
                                            btn_star_close.click();
                                            location.reload();
                                        });
                                    }else {
                                        console.log(data.message);
                                        Swal.fire("è©•åˆ†å¤±æ•—");
                                        btn_star_close.click();
                                    }
                                }).catch((error) => {
                                console.error("éŒ¯èª¤åŸå› 2ï¼š", error);
                            });
                        }
                    } else {
                        Swal.fire("è‡³å°‘éœ€å®Œæˆè©•åˆ†", "", "error");
                    }
                });
                // 2.1.2.0 æ–¹æ³•-æª¢æŸ¥&å›å‚³æ˜Ÿæ˜Ÿæ•¸
                function getStar() {
                    if (!span_el) {
                        return 0;
                    }
                    return Number.parseInt(span_el.getAttribute("data-star"), 10);
                }

                // 3. btn å›ä¸Šä¸€é 
                const order_btn_back = document.getElementsByClassName("order_btn_back")[0];
                order_btn_back.addEventListener("click", function () {
                    location.href = `./orderList.html`;
                });
            }
        }
        //=========================================================================================
        function statusText(statusNum) {
            switch (statusNum) {
                case 1 :
                    return "è¨‚å–®æˆç«‹";
                case 2 :
                    return "æº–å‚™å®Œæˆ";
                case 3 :
                    return "æ­£åœ¨å¤–é€";
                case 4 :
                    return "è¨‚å–®å®Œæˆ";
            }
        }
        function paymentMethodText() {
            return "ä¿¡ç”¨å¡";
        }
        function invoiceText(invoiceNum) {
            switch (invoiceNum) {
                case 1 : return "é›»å­ç™¼ç¥¨-æ‰‹æ©Ÿè¼‰å…·";
                case 2 : return "é›»å­ç™¼ç¥¨-ç¶ ç•Œæœƒå“¡";
                case 3 : return "é›»å­ç™¼ç¥¨-çµ±ä¸€ç™¼ç¥¨";
            }
        }
        function receiverMethodText(receiverNum) {
            switch (receiverNum) {
                case 1 :
                    return "è‡ªå–";
                case 2 :
                    return "å¤–é€";
            }
        }
        function nullText(nullValue) {
            if (nullValue != null) {
                return nullValue;
            } else {
                return "";
            }
        }
    });
</script>
</body>
</html>