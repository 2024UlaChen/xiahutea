<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>訂單明細</title>

  <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png"/>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i&display=swap"
        rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/font-awesome.min.css">
  <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
  <link rel="stylesheet" href="assets/css/animate.min.css">
  <link rel="stylesheet" href="assets/css/jquery-ui.css">
  <link rel="stylesheet" href="assets/css/slick.css">
  <link rel="stylesheet" href="assets/css/chosen.min.css">
  <link rel="stylesheet" href="assets/css/pe-icon-7-stroke.css">
  <link rel="stylesheet" href="assets/css/magnific-popup.min.css">
  <link rel="stylesheet" href="assets/css/lightbox.min.css">
  <link rel="stylesheet" href="assets/js/fancybox/source/jquery.fancybox.css">
  <link rel="stylesheet" href="assets/css/jquery.scrollbar.min.css">
  <link rel="stylesheet" href="assets/css/mobile-menu.css">
  <link rel="stylesheet" href="assets/fonts/flaticon/flaticon.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="css/general.css">
  <!-- SweetAlert2 CSS樣式 -->
  <link rel="stylesheet" href="/cms/plugins/sweetalert2/sweetalert2.css">

  <style>
      .material-symbols-outlined {
          font-variation-settings: 'FILL' 1, /*是否填滿 0 or 1*/ 'wght' 400, /*粗細 100 ~ 700*/ 'GRAD' 0, /*視覺平衡粗細 -25 0 200*/ 'opsz' 48 /*大小*/
      }
  </style>
  <style>
      /* 整個區塊 */
      .left-sidebar .content-area {
          margin-top: 10px;
          float: left;
          width: 100%;
          border-radius: 1%;
      }

      div.shop-top-control {
          display: flex;
          width: 100%;
          height: 100%;

      }

      /* 左右 兩區*/
      div.order_div {
          margin: 5px;
          padding: 5px;
          width: 50%;
          height: 100%;
          border-radius: 1%;
          min-width: 450px;
      }

      /* 店家區塊 */
      div#store_info {
          background-color: white;
          text-align: left;
          display: inline-flex;
          padding: 20px 0 20px 0;
          border-radius: 1%;
          width: 100%;
          height: 20%;
      }

      div#store_info div.store_name {
          font-size: 20px;
          font-weight: bold;
          line-height: 2;
          color: #517d81;
      }

      /* 店家區塊 > 店家logo */
      div.store_logo {
          width: 30%;
          height: 30%;
          min-width: 50px;
          max-width: 80px;
          aspect-ratio: 1/1; /* 設定元素的寬高比例為1:1 */
          margin: 15px auto; /* 這個置中方式(好像)只會對區塊元素生效 */
          overflow: hidden;
          border: 1px solid #00000020;
          border-radius: 50%;
      }

      div.store_logo img.store_logo_img {
          width: 100%;
          height: 100%;
          object-fit: cover;
      }

      /*  店家區塊 > 店家詳細 */
      div.store_detail {
          width: 60%;
      }

      div.store_detail div.store_name {
          font-weight: bold;
          color: black;
      }

      div.store_detail div.store_info_text span {
          color: black;
          line-height: 1;
      }

      /*  店家區塊 > 店家詳細 */
      div.store_others {
          width: 20%;
          display: inline;
      }

      /* 店家區塊 > btn爭議&評分 */
      button.btn_order_star, button.btn_dispute_apply {
          float: right; /* 將按鈕浮動到右邊 */
          margin-right: 20px;
          padding: 0;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-align: center;
          width: 100px;
          height: 40px;
          background-color: #73B4BA;
          border: 1px solid #73B4BA;
          font-size: 16px;
          color: white;
          border-radius: 5px;
      }

      button.btn_dispute_apply {
          margin-top: 15px;
      }

      button.btn_order_star.-close, button.btn_dispute_apply.-close {
          background-color: #6c757d;
          border: 1px solid #6c757d;
      }

      /* btn 回上一頁 */
      .order_btn_back_div {
          display: flex;
          justify-content: center; /* 水平置中 */
      }

      .order_btn_back {
          padding: 0;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-align: center;
          width: 100px;
          height: 40px;
          background-color: #F8F9FA;
          border: 1px solid #73B4BA;
          font-size: 16px;
          color: #53a0a7;
          border-radius: 5px;
      }

      /* 訂單明細區塊 */
      div.order_info {
          width: 100%;
          height: 80%;
          padding-top: 5px;
          margin: 5px 0 0 0;
          background-color: white;
          border-radius: 1%;
      }

      div.order_info table.order_info_tb {
          color: black;
          border-collapse: collapse; /* 合併邊框 */
          width: 100%; /* 調整寬度 */
          border-top: 0;
      }

      div.order_info th {
          font-weight: bold;
          width: 120px;
      }

      div.order_info th, td {
          border-bottom: 2px solid #c2c1c172; /* 設置下框線，黑色實線 */
          border-top: 0;
          padding: 8px; /* 設置內邊距 */
          text-align: left; /* 文字靠左 */
      }

      /* 商品區塊 */
      div.product_info {
          width: 100%;
          height: 100%;
          background-color: white;
          border-radius: 1%;
      }

      div.product_info li.product_li {
          padding: 5px;
          list-style-type: none;
      }

      div.product_info li.product_li ul {
          padding: 20px;
          margin: 5px;
          background-color: #f1f1f1;
      }

      div.product_info li.product_li ul.product_ul div.product_name {
          font-weight: bold;
          color: black;
          line-height: 2;
          font-size: 16px;
      }

      div.product_info li.product_li ul.product_ul span {
          line-height: 2;
          font-size: 14px;
      }

      /* 商品區塊-總計金額 */
      div.product_info div.product_total {
          padding: 10px 20px;
          color: black;
      }

      div.product_info div.pay_money {
          padding: 10px 20px 20px 20px;
          font-weight: bold;
          color: #517d81;
          font-size: 18px;
      }

      /* 訂單評分-燈箱 */
      button.btn_order_star {
          cursor: pointer;
      }

      #lightbox_star {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100vh;
          background-color: hsla(0, 0%, 0%, .5);
      }

      .none {
          display: none;
      }

      #lightbox_star > form {
          background-color: white;
          width: 90%;
          max-width: 600px;
          border-radius: 10px;
          height: 550px;
          padding: 10px;
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
      }

      .star_title_div {
          height: 300px; /* 設定高度，以便於垂直置中 */
      }

      p.star_title {
          margin-top: 30px;
          font-weight: bold;
          color: black;
          font-size: 18px;
          text-align: center;
      }

      .star_order_id_div {
          display: grid;
          place-items: center;
          margin-bottom: 50px;
      }

      input#star_order_id {
          text-align: center;
          height: 30px;
          width: 300px;
          border: 0 solid #bebebee4;
          font-weight: bold;
          color: black;
          font-size: 18px;
      }

      /* ==== 燈箱 > 評分星號區塊 ===== */
      div.star_block {
          margin-top: 10px;
          margin-bottom: 50px;
          display: flex;
          justify-content: center; /* 水平置中 */
          padding: 5px; /* 添加內邊距 */
      }

      /* ==== 燈箱 > 單個星號區塊 ===== */
      div.star_block > span.star {
          font-size: 30px;
          cursor: pointer;
          display: inline-block;
          margin-right: 3px;
      }

      /* ==== 燈箱 > 星號變色 ===== */
      div.star_block > span.star.-on {
          color: #FAC792;
      }

      /* ===== 燈箱 > 評分建議區塊 ===== */
      textarea#star_text {
          border: 1px rgba(128, 128, 128, 0.5) solid;
          margin: 0 10% 10px 10%;
          max-height: 100px;
          min-height: 100px;
          max-width: 80%;
          min-width: 80%;
          padding: 10px;
      }

      /* ===== 燈箱 > 評分按鈕 ===== */
      div.btn_star_close_div {
          display: flex;
          justify-content: center; /* 水平置中 */
          padding: 5px; /* 添加內邊距 */
      }

      div.btn_star_close_div > button#demo1 {
          padding: 10px 20px; /* 按鈕內部的內邊距 */
          margin: 10px;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-align: center;
          width: 100px;
          height: 40px;
          background-color: #73B4BA;
          border: 1px solid #73B4BA;
          font-size: 16px;
          color: white;
          border-radius: 5px;
      }

      div.btn_star_close_div > button#btn_star_close {
          padding: 10px 20px; /* 按鈕內部的內邊距 */
          margin: 10px;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-align: center;
          width: 100px;
          height: 40px;
          background-color: #F8F9FA;
          border: 1px solid #73B4BA;
          font-size: 16px;
          color: #53a0a7;
          border-radius: 5px;
      }
  </style>
</head>

<body>
<div class="header"></div>

<!--功能 區塊-->
<div class="main-content main-content-product left-sidebar">
  <div class="container">
    <div class="row">
      <div class="content-area shop-grid-content no-banner col-lg-9 col-md-9 col-sm-12 col-xs-12">
        <div class="shop-top-control">
          <div class="order_div">
            <div id="store_info">
              <!--  JS              -->
            </div>
            <div class="order_info">
              <table class="order_info_tb">
                <!-- JS             -->
              </table>
            </div>

            <!-- 訂單評分燈箱 -->
            <div id="lightbox_star" class="none">
              <form>
                <div class="star_title_div">
                  <!--  JS                -->
                </div>
              </form>
            </div>
            <!--/ 訂單評分燈箱 -->

            <div class="order_btn_back_div">
              <button class="order_btn_back">回上一頁</button>
            </div>
          </div>
          <div class="order_div">
            <div class="product_info">
              <!--  JS                -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="footer"></div>

<script src="assets/js/jquery-1.12.4.min.js"></script>
<script src="assets/js/jquery.plugin-countdown.min.js"></script>
<script src="assets/js/jquery-countdown.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/owl.carousel.min.js"></script>
<script src="assets/js/magnific-popup.min.js"></script>
<script src="assets/js/isotope.min.js"></script>
<script src="assets/js/jquery.scrollbar.min.js"></script>
<script src="assets/js/jquery-ui.min.js"></script>
<script src="assets/js/mobile-menu.js"></script>
<script src="assets/js/chosen.min.js"></script>
<script src="assets/js/slick.js"></script>
<script src="assets/js/jquery.elevateZoom.min.js"></script>
<script src="assets/js/jquery.actual.min.js"></script>
<script src="assets/js/fancybox/source/jquery.fancybox.js"></script>
<script src="assets/js/lightbox.min.js"></script>
<script src="assets/js/owl.thumbs.min.js"></script>
<script src="assets/js/jquery.scrollbar.min.js"></script>
<script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyC3nDHy1dARR-Pa_2jjPCjvsOR4bcILYsM'></script>
<script src="assets/js/frontend-plugin.js"></script>
<script src="assets/js/newjs.js"></script>
<script src="./js/general.js"></script>
<!-- sweet alert  -->
<script src="cms/plugins/sweetalert2/sweetalert2.all.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // 取得sessionStorage會員ID
        const memberData = JSON.parse(sessionStorage.getItem("memberData"));
        const customerId = memberData.data.customerId;
        if(!memberData || customerId == null){
            Swal.fire("請先登入會員");
            location.href = `./homePage.html`;
            return;
        }
        // 取得URL的查詢參數
        function getQueryParam(param) {
            let urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        //-------------------------------------------------------
        // 0. 顯示明細
        init();
        function init() {
            let orderId = getQueryParam("orderId");
            if (orderId) {
                fetch(`/order/member/detail/${orderId}`)
                    .then(resp => resp.json())
                    .then(data =>{
                        // console.log(data)
                        showDB(data); // 顯示資料
                    })
                    .catch((error) => {
                        console.log("錯誤原因:" + error);
                    });
            }
        }

        function showDB(data) {
            let storeInfoHtml;
            storeInfoHtml = `
                 <div class="store_logo">
                    <img class="store_logo_img" src="data:${data.orders.store.contentType};base64,${data.orders.store.logo}" alt="店家logo">
                </div>
                <div class="store_detail">
                    <div class="store_name">${data.orders.store.storeName}</div>
                    <span><b>店家資訊</b></span><br>
                    <div class="store_info_text">
                        <span>📞</span><span>${data.orders.store.storePhone}</span><br>
                        <span>📍</span><span>${data.orders.store.storeAddress}</span>
                    </div>
                </div>
                <div class="store_others">
                    <button type="button" class="btn_order_star">訂單評分</button>
                    <button class="btn_dispute_apply">爭議申請</button>
                </div>
            `;
            const store_info_el = document.getElementById("store_info");

            let orderInfoHtml;
            orderInfoHtml = `
                <tbody>
                    <tr>
                        <th>訂單編號</th>
                        <td>${data.orders.orderId}</td>
                    </tr>
                    <tr>
                        <th>訂單狀態</th>
                        <td>${statusText(data.orders.orderStatus)}</td>
                    </tr>
                    <tr>
                        <th>付款方式</th>
                        <td>${paymentMethodText(data.orders.paymentMethod)}</td>
                    </tr>
                    <tr>
                        <th>付款金額</th>
                        <td>${data.orders.paymentAmount}</td>
                    </tr>
                    <tr>
                        <th>發票開立方式</th>
                        <td>[${invoiceText(data.orders.invoiceMethod)}] ${nullText(data.orders.invoiceNo)} ${nullText(data.orders.invoiceVat)} ${nullText(data.orders.invoiceCarrier)} </td>
                    </tr>
                    <tr>
                        <th>取貨方式</th>
                        <td>${receiverMethodText(data.orders.receiverMethod)}</td>
                    </tr>
                     <tr>
                        <th>取貨時間</th>
                        <td id="receiver_date">${data.orders.receiverDatetime}</td>
                    </tr>
                    <tr>
                        <th>取貨人</th>
                        <td>${data.orders.receiverName}</td>
                    </tr>
                    <tr>
                        <th>取貨人電話</th>
                        <td>${data.orders.receiverPhone}</td>
                    </tr>
                    <tr>
                        <th>取貨人地址</th>
                        <td>${nullText(data.orders.receiverAddress)}</td>
                    </tr>
                    <tr>
                        <th>訂單備註</th>
                        <td>${nullText(data.orders.orderNote)}</td>
                    </tr>
                    <tr>
                        <th>訂單成立時間</th>
                        <td id="order_date">${data.orders.orderCreateDatetime}</td>
                    </tr>
                </tbody>
        `;
            document.getElementsByClassName("order_info_tb")[0].innerHTML = orderInfoHtml;
            //-------------------------------------------------------------------

            if (store_info_el) {
                store_info_el.innerHTML = storeInfoHtml;

                // 1. btn 爭議申請
                // 1.1 當訂單建立日超過2天 鎖定爭議btn
                const btn_dispute_apply = store_info_el.querySelector(".btn_dispute_apply");
                let receiver_date_el = document.getElementById("receiver_date");
                if (receiver_date_el) {
                    const date_text = receiver_date_el.textContent; // 取得 <td> 裡的文本
                    const date_part1 = date_text.split(' '); // ["2024/08/07", "14:30"]
                    const date_part2 = date_part1[0].split('/'); // ["2024", "08", "07"]
                    const date_part3 = date_part1[1].split(':'); // ["14", "30"]
                    const receiver_date = new Date(
                        parseInt(date_part2[0]), // 年
                        parseInt(date_part2[1]) - 1, // 月 (從 0 開始)
                        parseInt(date_part2[2]), // 日
                        parseInt(date_part3[0]), // 時
                        parseInt(date_part3[1])  // 分
                    );
                    const receiver_date_2day = new Date(receiver_date);
                    receiver_date_2day.setDate(receiver_date_2day.getDate() + 2); // 訂單日期+加兩天
                    let now_date = new Date(); //現在的時間

                    if (receiver_date_2day < now_date) {
                        btn_dispute_apply.classList.add("-close");
                        btn_dispute_apply.setAttribute("disabled", "disabled");
                        btn_dispute_apply.innerHTML = "訂單完成";
                    }
                }

                // 1.2 爭議btn 可點擊時 link爭議申請表
                btn_dispute_apply.addEventListener("click", function () {
                    location.href = `./orderDispute.html?orderId=${data.orders.orderId}`;
                });

                // 1.3 如果後端已有爭議資料 更改 鎖定爭議btn
                if(data.disputeOrder && data.disputeOrder.disputeOrderId){
                    btn_dispute_apply.classList.add("-close");
                    btn_dispute_apply.setAttribute("disabled", "disabled");
                    btn_dispute_apply.innerHTML="已送爭議";
                }
            }

            let productInfoHtml;
            productInfoHtml = `
              <div class="product_list">
                  <li class="product_li">
                        <!--   商品明細寫在JS    -->
                  </li>
              </div>
              <div class="product_total">
                   <span>商品  x  ${data.orders.orderProductQuantity}</span>
              </div>
              <div class="pay_money">
                  <span>訂單金額</span>
                  <span class="pay_money_num">$ ${data.orders.productAmount}</span>
              </div>
        `;
            document.getElementsByClassName("product_info")[0].innerHTML = productInfoHtml;

            let productHtml = "";
            let detailList = data.orderDetails;
            for (let i = 0; i < detailList.length; i++) {
                productHtml += `
                <ul class="product_ul">
                    <div class="product_name">${detailList[i].product.productName}  ( ${detailList[i].product.size} )</div>
                    <span>${detailList[i].productSugar} / ${detailList[i].productTemperature} / ${detailList[i].productAddMaterials} / $ ${detailList[i].productPrice} / ${detailList[i].productQuantity} 項</span>
                </ul>
            `;
            }
            document.getElementsByClassName("product_li")[0].innerHTML = productHtml;

            let starHtml;
            starHtml = `
                <p class="star_title">訂單編號</p>
                <div class="star_order_id_div">
                    <label for="star_order_id"></label><input id="star_order_id" type="text" name="star_order_id" value="${data.orders.orderId}" disabled>
                </div>
                <p class="star_title">關於訂單的評分</p>
                <div class="star_block">
                    <span class="star" data-star="1"><i class="fa fa-star"></i></span>
                    <span class="star" data-star="2"><i class="fa fa-star"></i></span>
                    <span class="star" data-star="3"><i class="fa fa-star"></i></span>
                    <span class="star" data-star="4"><i class="fa fa-star"></i></span>
                    <span class="star" data-star="5"><i class="fa fa-star"></i></span>
                </div>
                <p class="star_title">關於訂單的意見</p>
                <label for="star_text"></label><textarea id="star_text" type="text" name="star_text" placeholder="建議可對口味、包裝等細節提供評論"></textarea>
                <div class="btn_star_close_div" >
                    <button type="button" id="demo1" class="btn_star_submit">送出</button>
                    <button type="button" id="btn_star_close">取消</button>
                </div>
            `;
            const star_title_el = document.getElementsByClassName("star_title_div")[0];
            if (star_title_el) {
                star_title_el.innerHTML = starHtml;

                // 2. btn 訂單評分
                // 2.0 判斷燈箱 btn狀態  disabled css樣式
                const btn_order_star = store_info_el.querySelector(".btn_order_star");
                if(btn_order_star){
                    if (data.orders.orderScore != null){
                        btn_order_star.classList.add("-close");
                        btn_order_star.setAttribute("disabled", "disabled");
                        btn_order_star.innerHTML = "評分完成";
                    }
                    // 2.1 燈箱操作 > 打開燈箱
                    let lightbox_el = document.getElementById("lightbox_star");
                    btn_order_star.addEventListener("click", function () {
                        lightbox_el.classList.remove("none");
                    });
                    // 2.2 燈箱操作 > 關閉燈箱
                    const btn_star_close = document.getElementById("btn_star_close");
                    btn_star_close.addEventListener("click", function () {
                        lightbox_el.classList.add("none");
                    });
                    lightbox_el.addEventListener("click", function () {
                        this.classList.add("none");
                    });
                    lightbox_el.querySelector("form").addEventListener("click", function (e) {
                        e.stopPropagation();
                    });
                }

                // 2.1.1 打開燈箱 > 評分星星點擊
                let span_el;
                let star_title_div_el = document.getElementsByClassName("star_title_div")[0];
                star_title_div_el.addEventListener("click", function (e) {
                    if (e.target.closest("span.star")) {
                        span_el = e.target.closest("span.star");
                        let current_star = parseInt(span_el.getAttribute("data-star"));
                        let star_span = span_el.closest("div.star_block").querySelectorAll("span.star");
                        star_span.forEach(function (star_item, i) {
                            if (parseInt(star_item.getAttribute("data-star")) <= current_star) {
                                star_span[i].classList.add("-on");
                            } else {
                                star_span[i].classList.remove("-on");
                            }
                        });
                    }
                });

                // 2.1.2 打開燈箱 > btn送出 點擊後檢查欄位，送資料到後端，關閉視窗後disabled btn
                const btn_star_submit = star_title_el.querySelector(".btn_star_submit");
                btn_star_submit.addEventListener("click", function (e) {
                    let order_id = document.getElementById("star_order_id");
                    const order_score = getStar();
                    let order_feedback = document.getElementById("star_text");
                    if (order_score > 0) {
                        let star_data = {
                            orderId: order_id.innerText,
                            orderScore: order_score + '',
                            orderFeedback: order_feedback.value
                        };

                        let orderId = getQueryParam("orderId");
                        if (orderId) {
                            fetch(`/order/member/star/${orderId}`, {
                                method: "PUT",
                                headers: {
                                    'Content-Type': 'application/json' // 設置內容類型為 JSON
                                },
                                body: JSON.stringify(star_data) // 將資料轉為 JSON 格式
                            })
                                .then(res => res.json())
                                .then(data => {
                                    if (data.successful) {
                                        console.log(data.message);
                                        Swal.fire({
                                            title: '已送出評分',
                                            text: '',
                                            icon: 'success',
                                            showConfirmButton: true  // 確認按鈕
                                        }).then(() => {
                                            btn_star_close.click();
                                            location.reload();
                                        });
                                    }else {
                                        console.log(data.message);
                                        Swal.fire("評分失敗");
                                        btn_star_close.click();
                                    }
                                }).catch((error) => {
                                console.error("錯誤原因2：", error);
                            });
                        }
                    } else {
                        Swal.fire("至少需完成評分", "", "error");
                    }
                });
                // 2.1.2.0 方法-檢查&回傳星星數
                function getStar() {
                    if (!span_el) {
                        return 0;
                    }
                    return Number.parseInt(span_el.getAttribute("data-star"), 10);
                }

                // 3. btn 回上一頁
                const order_btn_back = document.getElementsByClassName("order_btn_back")[0];
                order_btn_back.addEventListener("click", function () {
                    location.href = `./orderList.html`;
                });
            }
        }
        //=========================================================================================
        function statusText(statusNum) {
            switch (statusNum) {
                case 1 :
                    return "訂單成立";
                case 2 :
                    return "準備完成";
                case 3 :
                    return "正在外送";
                case 4 :
                    return "訂單完成";
            }
        }
        function paymentMethodText() {
            return "信用卡";
        }
        function invoiceText(invoiceNum) {
            switch (invoiceNum) {
                case 1 : return "電子發票-手機載具";
                case 2 : return "電子發票-綠界會員";
                case 3 : return "電子發票-統一發票";
            }
        }
        function receiverMethodText(receiverNum) {
            switch (receiverNum) {
                case 1 :
                    return "自取";
                case 2 :
                    return "外送";
            }
        }
        function nullText(nullValue) {
            if (nullValue != null) {
                return nullValue;
            } else {
                return "";
            }
        }
    });
</script>
</body>
</html>